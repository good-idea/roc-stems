{"version":3,"sources":["node_modules/browser-pack/_prelude.js","node_modules/@artcommacode/q/index.js","src/js/components/Button.js","src/js/components/Stem.js","src/js/components/Track.js","src/js/components/publisher.js","src/js/stems.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","/Users/Joseph/Sites/rideorcry/stems/node_modules/@artcommacode/q/index.js","module","_toConsumableArray","arr","Array","isArray","arr2","from","Object","defineProperty","value","toArray","list","concat","first","xs","elemError","String","getRoot","document","body","contains","query","q","root","querySelectorAll","queryOne","makeButton","el","buttonIndex","publisher","button","element","enable","enabled","classList","add","disable","remove","toggleEnabled","activate","active","deactivate","toggleActive","inputState","subscribe","count","addEventListener","event","emit","makeStem","src","stem","audio","Audio","load","loadedCallback","fileName","replace","split","pop","xhr","XMLHttpRequest","open","encodeURI","setRequestHeader","responseType","onload","blob","Blob","response","type","objectUrl","URL","createObjectURL","revokeObjectURL","ready","error","target","status","statusText","send","play","initialize","volume","Promise","resolve","reject","then","catch","reset","pause","currentTime","stop","unmute","console","log","mute","makeTrack","trackIndex","stemLoadedHandler","err","loadedStems","track","hasError","stems","isLoaded","autoplay","handleClick","pad","input","padLength","arguments","char","direction","string","toString","diff","formatDecimal","lLength","rLength","push","substr","stemSources","JSON","parse","getAttribute","autoload","hasAttribute","map","stemElement","_Stem2","default","initializeStems","all","setTimeout","startTime","Date","now","getCurrentTime","times","stemMax","Math","max","apply","elapsed","unmuteStem","stemIndex","muteStem","newIndex","filter","debugOutput","_q","innerHTML","setInterval","debugString","min","index","activated","round","formattedTime","join","_Stem","__esModule","PubSubEmitter","_classCallCheck","this","listeners","Map","topic","callback","has","set","get","reduce","listener","currentIndex","splice","key","_len","args","_key","forEach","_publisher","_Track","_Button","c","trackElements","everything","buttons","tracks","newTrack","_Track2","_publisher2","newButton","_Button2","./components/Button","./components/Track","./components/publisher","@artcommacode/q"],"mappings":"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","file":"stems.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\nvar toArray = function toArray(list) {\n  return [].concat(_toConsumableArray(list));\n};\n\nvar first = function first(xs) {\n  return xs[0];\n};\n\nvar elemError = function elemError(e) {\n  throw new Error(\"\\\"\" + String(e) + \"\\\" does't exist in the document\");\n};\n\nvar getRoot = function getRoot(e) {\n  return !e ? document : document && document.body && document.body.contains(e) ? e : elemError(e);\n};\n\nvar query = exports.query = function query(q, e) {\n  var root = getRoot(e);\n  return root ? toArray(root.querySelectorAll(q)) : [];\n};\n\nvar queryOne = exports.queryOne = function queryOne(q, e) {\n  return first(query(q, e));\n};\n","\n/**\n * Receives a DOM element.\n * Returns an object with enable, activate, and deactivate methods\n * @param  {DOM element} element\n * @return {Shape}\n */\n\nfunction makeButton(el, buttonIndex, publisher) {\n\tconst button = {};\n\tbutton.element = el;\n\n\tbutton.enable = function enable() {\n\t\tbutton.enabled = true;\n\t\tbutton.element.classList.add('enabled');\n\t};\n\n\tbutton.disable = function disable() {\n\t\tbutton.enabled = false;\n\t\tbutton.element.classList.remove('enabled');\n\t};\n\n\tbutton.toggleEnabled = function toggleEnabled() {\n\t\tif (button.enabled) {\n\t\t\tbutton.disable();\n\t\t} else {\n\t\t\tbutton.enable();\n\t\t}\n\t};\n\n\tbutton.activate = function activate() {\n\t\tif (!button.enabled) button.enable();\n\t\tbutton.active = true;\n\t\tbutton.element.classList.add('active');\n\t};\n\n\tbutton.deactivate = function deactivate() {\n\t\tbutton.active = false;\n\t\tbutton.element.classList.remove('active');\n\t};\n\n\tbutton.toggleActive = function toggleActive(inputState) {\n\t\tbutton.active = inputState || !button.active;\n\t\tif (button.active === true) {\n\t\t\tbutton.activate();\n\t\t} else {\n\t\t\tbutton.deactivate();\n\t\t}\n\t};\n\n\t/**\n\t * EVENTS\n\t */\n\n\tpublisher.subscribe('enableButtons', (count) => {\n\t\t// console.log('buttons:', count);\n\t\tif (buttonIndex <= count - 1) {\n\t\t\tbutton.enable();\n\t\t\tbutton.activate();\n\t\t} else {\n\t\t\tbutton.disable();\n\t\t\tbutton.deactivate();\n\t\t}\n\t});\n\n\tpublisher.subscribe('disableButtons', () => {\n\t\tbutton.deactivate();\n\t});\n\n\tbutton.element.addEventListener('click', () => {\n\t\tbutton.toggleActive();\n\t\tconst event = (button.active) ? 'stemActivated' : 'stemDeactivated';\n\t\tpublisher.emit(event, buttonIndex);\n\t});\n\n\treturn button;\n}\n\nexport default makeButton;\n","/**\n * Receives a DOM element with links to audio files to be played in tandem as stems.\n * Returns an object with play/pause/mute methods\n * @param  {DOM element} element\n * @return {Stem}\n */\n\nfunction makeStem(src) {\n\tconst stem = {};\n\tstem.audio = new Audio();\n\n\tstem.load = function loadStem(loadedCallback) {\n\t\tstem.fileName = src.replace(/\\/$/).split('/').pop();\n\t\tconst xhr = new XMLHttpRequest();\n\t\txhr.open('GET', encodeURI(src), true);\n\t\txhr.setRequestHeader('Content-Type', 'application/json');\n\t\txhr.responseType = 'blob';\n\t\txhr.onload = (e) => {\n\t\t\tconst blob = new Blob([xhr.response], { type: 'audio/mp3' });\n\t\t\tconst objectUrl = URL.createObjectURL(blob);\n\t\t\tstem.audio.src = objectUrl;\n\t\t\tstem.audio.onload = () => {\n\t\t\t\tURL.revokeObjectURL(objectUrl);\n\t\t\t};\n\t\t\tstem.ready = true;\n\t\t\tconst error = (e.target.status !== 200) ? `${e.target.status} ${e.target.statusText}` : false;\n\t\t\tloadedCallback(error);\n\t\t};\n\t\txhr.send();\n\t};\n\n\tstem.play = function playStem(initialize) {\n\t\tif (initialize) stem.audio.volume = 0;\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tif (!stem.ready) reject('stem is not ready');\n\t\t\tstem.audio.play().then(() => {\n\t\t\t\tstem.audio.volume = 1;\n\t\t\t\tstem.active = true;\n\t\t\t\tresolve();\n\t\t\t}).catch(() => {\n\t\t\t\treject();\n\t\t\t});\n\t\t});\n\t};\n\n\tstem.reset = function resetStem() {\n\t\tstem.audio.pause();\n\t\tstem.audio.currentTime = 0;\n\t};\n\n\tstem.stop = function stopStem() {\n\t\tstem.active = false;\n\t\tstem.audio.pause();\n\t};\n\n\tstem.unmute = function unmuteStem(currentTime) {\n\t\t// if iOS has prevented volume change, it will still be 1\n\t\tif (currentTime && stem.audio.volume === 1) {\n\t\t\tif (currentTime) stem.audio.currentTime = currentTime;\n\t\t\tconsole.log(stem.audio.currentTime);\n\t\t\tstem.play();\n\t\t} else {\n\t\t\tstem.active = true;\n\t\t\tstem.audio.volume = 1;\n\t\t}\n\t};\n\n\tstem.mute = function muteStem() {\n\t\tstem.active = false;\n\t\tstem.audio.volume = 0;\n\t\t// iOS will prevent volume change. Stop the track instead\n\t\tif (stem.audio.volume === 1) {\n\t\t\tstem.stop();\n\t\t}\n\t};\n\n\treturn stem;\n}\n\n\nexport default makeStem;\n","import { query, queryOne } from '@artcommacode/q';\nimport makeStem from './Stem';\n\n/**\n * Receives a DOM element with links to audio files to be played in tandem as stems.\n * Returns an object with play/pause/mute methods\n * @param  {DOM element} element\n * @return {Stem}\n */\nfunction makeTrack(el, trackIndex, publisher) {\n\tconst track = {};\n\ttrack.element = el;\n\tconst stemSources = JSON.parse(track.element.getAttribute('data-stems'));\n\n\tconst autoload = track.element.hasAttribute('autoload') && track.element.getAttribute('autoload') !== 'false';\n\tconst autoplay = track.element.hasAttribute('autoplay') && track.element.getAttribute('autoplay') !== 'false';\n\n\tconst stems = [];\n\tlet loadedStems = 0;\n\n\t// add each element to the tracks array.\n\tstemSources.map((stemElement) => {\n\t\tconst stem = makeStem(stemElement);\n\t\tstems.push(stem);\n\t});\n\n\t/**\n\t * FUNCTIONS\n\t */\n\n\t/**\n\t * Track the number of loaded stems.\n\t * Set error status if necessary.\n\t */\n\tfunction stemLoadedHandler(err) {\n\t\tloadedStems += 1;\n\t\tif (err) {\n\t\t\ttrack.hasError = true;\n\t\t\ttrack.element.classList.add('has-errors');\n\t\t}\n\t\tif (loadedStems === stems.length) {\n\t\t\ttrack.isLoaded = true;\n\t\t\ttrack.element.classList.remove('loading');\n\t\t\ttrack.element.classList.add('loaded');\n\t\t\tif (autoplay) track.play();\n\t\t}\n\t}\n\n\t/**\n\t * If the track hasn't loaded, load the stems. Otherwise, play.\n\t */\n\tfunction handleClick() {\n\t\tif (!track.isLoaded) {\n\t\t\ttrack.load();\n\t\t} else {\n\t\t\ttrack.play();\n\t\t}\n\t}\n\n\t/**\n\t * METHODS\n\t */\n\n\ttrack.load = function loadTrack() {\n\t\ttrack.element.classList.add('loading');\n\t\tstems.map(stem => stem.load(stemLoadedHandler));\n\t};\n\n\ttrack.play = function playTrack() {\n\t\ttrack.active = true;\n\t\tconst initializeStems = [];\n\t\tstems.map((stem) => {\n\t\t\tinitializeStems.push(stem.play(true));\n\t\t});\n\t\tPromise.all(initializeStems).then(() => {\n\t\t\tpublisher.emit('trackPlayed', trackIndex);\n\t\t\tsetTimeout(() => {\n\t\t\t\t// const playAttempts = [];\n\t\t\t\tstems.map((stem) => {\n\t\t\t\t\tstem.reset();\n\t\t\t\t\tstem.play();\n\t\t\t\t});\n\t\t\t\tpublisher.emit('enableButtons', stems.length);\n\t\t\t\ttrack.element.classList.add('playing');\n\t\t\t\ttrack.startTime = Date.now();\n\t\t\t}, 400);\n\t\t});\n\t};\n\n\ttrack.stop = function stopTrack() {\n\t\ttrack.active = false;\n\t\ttrack.startTime = false;\n\t\tstems.map(stem => stem.reset());\n\t\t// publisher.emit('enableButtons', stems.length);\n\t\ttrack.element.classList.remove('playing');\n\t};\n\n\ttrack.getCurrentTime = function getCurrentTime() {\n\t\tif (!track.active) return null;\n\t\tconst times = [];\n\t\tstems.map((stem) => {\n\t\t\ttimes.push(stem.audio.currentTime);\n\t\t});\n\t\tconst stemMax = Math.max(...times);\n\t\tconsole.log('mathmax: ', stemMax);\n\n\t\tconst now = Date.now();\n\t\tconst elapsed = (now - track.startTime) / 1000;\n\n\t\tconsole.log('elapsed: ', elapsed);\n\n\t\t// If all tracks have been muted, their currentTime values will have stopped counting.\n\t\t// We're trying to simulate a \"mute\", but they are paused - so the elapsed time will be\n\t\t// a more accurate time to start.\n\t\treturn Math.max(elapsed, stemMax);\n\t};\n\n\ttrack.unmuteStem = function unmuteStem(stemIndex) {\n\t\tif (track.active) {\n\t\t\tconst currentTime = track.getCurrentTime();\n\t\t\tconsole.log(currentTime);\n\t\t\tstems[stemIndex].unmute(currentTime);\n\t\t}\n\t};\n\n\ttrack.muteStem = function muteStem(stemIndex) {\n\t\tif (track.active) stems[stemIndex].mute();\n\t};\n\n\t/*\n   * EVENTS\n\t */\n\n\ttrack.element.addEventListener('click', handleClick);\n\n\tpublisher.subscribe('trackPlayed', (newIndex) => {\n\t\tif (newIndex !== trackIndex) {\n\t\t\ttrack.active = false;\n\t\t\ttrack.stop();\n\t\t}\n\t});\n\n\tpublisher.subscribe('stemActivated', track.unmuteStem);\n\n\tpublisher.subscribe('stemDeactivated', track.muteStem);\n\n\tpublisher.subscribe('allStemsToggled', () => {\n\t\tif (track.active) {\n\t\t\tconst allEnabled = (stems.filter(stem => stem.active).length === stems.length);\n\t\t\tif (allEnabled) {\n\t\t\t\tstems.map((stem, stemIndex) => track.muteStem(stemIndex));\n\t\t\t\tpublisher.emit('disableButtons', stems.length);\n\t\t\t} else {\n\t\t\t\tstems.map((stem, stemIndex) => track.unmuteStem(stemIndex));\n\t\t\t\tpublisher.emit('enableButtons', stems.length);\n\t\t\t}\n\t\t}\n\t});\n\n\tif (autoload) track.load();\n\n\n\t/**\n\t * Debug logging\n\t */\n\n\tconst debugOutput = queryOne('#debug-output');\n\n\tpublisher.subscribe('trackPlayed', () => {\n\t\tdebugOutput.innerHTML = '';\n\t});\n\n\tfunction pad(input, padLength = 2, char = '0', direction = 'right') {\n\t\tlet string = input.toString();\n\t\tconst diff = padLength - input.length;\n\t\tfor (let i = 0; i < diff; i += 1) {\n\t\t\tif (direction === 'right') {\n\t\t\t\tstring += char;\n\t\t\t} else {\n\t\t\t\tstring = char + string;\n\t\t\t}\n\t\t}\n\t\treturn string;\n\t}\n\n\tfunction formatDecimal(input, lLength, rLength) {\n\t\tconst arr = input.toString().split('.');\n\t\tif (arr.length === 1) arr.push('0');\n\t\tconst whole = pad(arr[0], lLength, '0', 'left');\n\t\tconst dec = pad(arr[1], rLength, '0', 'right').substr(0, rLength);\n\t\treturn `${whole}.${dec}`;\n\t}\n\n\tsetInterval(() => {\n\t\tif (track.active) {\n\t\t\tconst debugString = ['*******'];\n\t\t\tlet min;\n\t\t\tlet max;\n\t\t\tstems.map((stem, index) => {\n\t\t\t\tif (stem.audio) {\n\t\t\t\t\tconst activated = (stem.active) ? '(on)' : '(off)';\n\t\t\t\t\tconst currentTime = Math.round(stem.audio.currentTime * 10000) / 10000;\n\t\t\t\t\tconst formattedTime = formatDecimal(currentTime, 3, 4);\n\n\t\t\t\t\tif (stem.active) {\n\t\t\t\t\t\tmin = (min) ? Math.min(min, currentTime) : currentTime;\n\t\t\t\t\t\tmax = (max) ? Math.max(max, currentTime) : currentTime;\n\t\t\t\t\t}\n\t\t\t\t\tif (currentTime === 0) {\n\t\t\t\t\t\tstem.audio.play().catch(() => {\n\t\t\t\t\t\t\ttrack.active = false;\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\ttry {\n\t\t\t\t\t\tdebugString.push(`   stem ${index + 1}: ${formattedTime} | ${stem.fileName} - ${activated}`);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t// do nothing\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tconst diff = formatDecimal(max - min, 1, 6);\n\t\t\tdebugString.push(`   max diff: ${diff}`);\n\t\t\tdebugOutput.innerHTML = debugString.join('<br>');\n\t\t}\n\t}, 100);\n\n\n\treturn track;\n}\n\n\nexport default makeTrack;\n","\nclass PubSubEmitter {\n\tconstructor() {\n\t\t// create a new Map to hold all of the topics\n\t\tthis.listeners = new Map();\n\t}\n\n\tsubscribe(topic, callback) {\n\t\t// if the listener does not hae the topic yet, add it.\n\t\tif (!this.listeners.has(topic)) this.listeners.set(topic, []);\n\t\t// push the callback to the topic's array\n\t\tthis.listeners.get(topic).push(callback);\n\t}\n\n\tunsubscribe(topic, callback) {\n\t\tconst listeners = this.listeners.get(topic);\n\t\tlet index;\n\n\t\tif (listeners && listeners.length) {\n\t\t\t// find the index of the callback we're removing\n\t\t\tindex = listeners.reduce((i, listener, currentIndex) => {\n\t\t\t\t(typeof(listener) === 'function' && listener === callback) ?\n\t\t\t\t\ti = currentIndex :\n\t\t\t\t\ti;\n\t\t\t}, -1);\n\n\t\t\tif (index > -1) {\n\t\t\t\t// if we found a match, splice it out, and resupply the map with the spliced array\n\t\t\t\tlisteners.splice(index, 1);\n\t\t\t\tthis.listeners.set(topic, listeners);\n\t\t\t\treturn true; // return true if we removed something\n\t\t\t}\n\t\t}\n\t\treturn false; // return false if we didn't\n\t}\n\n\temit(topic, ...args) {\n\t\t// get the listeners subscribed to the topic\n\t\tconst listeners = this.listeners.get(topic);\n\n\t\tif (listeners && listeners.length) {\n\t\t\t// execute each callback with any supplied arguments\n\t\t\tlisteners.forEach((listener) => {\n\t\t\t\tlistener(...args);\n\t\t\t});\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n}\n\nconst publisher = new PubSubEmitter();\n\nexport default publisher;\n","// A small utility for getting DOM elements\nimport { query, queryOne } from '@artcommacode/q';\n\n// A component you can use to emit and subscribe to events.\n// Helpful to decouple UI stuff\nimport publisher from './components/publisher';\nimport makeTrack from './components/Track';\nimport makeButton from './components/Button';\n\n// first, just find the elements\nconst trackElements = query('.stem-track');\nconst everything = queryOne('.stem-button--play-all') || false;\nconst buttons = [];\nconst tracks = [];\n\n// add each composed track to an array\ntrackElements.map((track, index) => {\n\tconst newTrack = makeTrack(track, index, publisher);\n\ttracks.push(newTrack);\n});\n\nquery('.stem-buttons .stem-button').map((button, index) => {\n\tconst newButton = makeButton(button, index, publisher);\n\tbuttons.push(newButton);\n});\n\n/**\n * Event Listeners\n */\n\nif (everything) {\n\teverything.addEventListener('click', () => {\n\t\tpublisher.emit('allStemsToggled');\n\t});\n}\n\n// Use each track element as the source of a Stem object\n"]}