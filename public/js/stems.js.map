{"version":3,"sources":["node_modules/browser-pack/_prelude.js","node_modules/@artcommacode/q/index.js","src/js/components/Button.js","src/js/components/Stem.js","src/js/components/Track.js","src/js/components/publisher.js","src/js/stems.js"],"names":[],"mappings":"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","file":"stems.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\nvar toArray = function toArray(list) {\n  return [].concat(_toConsumableArray(list));\n};\n\nvar first = function first(xs) {\n  return xs[0];\n};\n\nvar elemError = function elemError(e) {\n  throw new Error(\"\\\"\" + String(e) + \"\\\" does't exist in the document\");\n};\n\nvar getRoot = function getRoot(e) {\n  return !e ? document : document && document.body && document.body.contains(e) ? e : elemError(e);\n};\n\nvar query = exports.query = function query(q, e) {\n  var root = getRoot(e);\n  return root ? toArray(root.querySelectorAll(q)) : [];\n};\n\nvar queryOne = exports.queryOne = function queryOne(q, e) {\n  return first(query(q, e));\n};\n","\n/**\n * Receives a DOM element.\n * Returns an object with enable, activate, and deactivate methods\n * @param  {DOM element} element\n * @return {Shape}\n */\n\nfunction makeButton(el, buttonIndex, publisher) {\n\tconst button = {};\n\tbutton.element = el;\n\n\tbutton.enable = function enable() {\n\t\tbutton.enabled = true;\n\t\tbutton.element.classList.add('enabled');\n\t};\n\n\tbutton.disable = function disable() {\n\t\tbutton.enabled = false;\n\t\tbutton.element.classList.remove('enabled');\n\t};\n\n\tbutton.toggleEnabled = function toggleEnabled() {\n\t\tif (button.enabled) {\n\t\t\tbutton.disable();\n\t\t} else {\n\t\t\tbutton.enable();\n\t\t}\n\t};\n\n\tbutton.activate = function activate() {\n\t\tif (!button.enabled) button.enable();\n\t\tbutton.active = true;\n\t\tbutton.element.classList.add('active');\n\t};\n\n\tbutton.deactivate = function deactivate() {\n\t\tbutton.active = false;\n\t\tbutton.element.classList.remove('active');\n\t};\n\n\tbutton.toggleActive = function toggleActive(inputState) {\n\t\tbutton.active = inputState || !button.active;\n\t\tif (button.active === true) {\n\t\t\tbutton.activate();\n\t\t} else {\n\t\t\tbutton.deactivate();\n\t\t}\n\t};\n\n\t/**\n\t * EVENTS\n\t */\n\n\tpublisher.subscribe('enableButtons', (count) => {\n\t\tif (buttonIndex <= count - 1) {\n\t\t\tbutton.enable();\n\t\t\tbutton.activate();\n\t\t} else {\n\t\t\tbutton.disable();\n\t\t\tbutton.deactivate();\n\t\t}\n\t});\n\n\tbutton.element.addEventListener('click', () => {\n\t\tbutton.toggleActive();\n\t\tconst event = (button.active) ? 'stemActivated' : 'stemDeactivated';\n\t\tpublisher.emit(event, buttonIndex);\n\t});\n\t//\n\t// publisher.subscribe('allButtonsDisabled', button.disable);\n\t//\n\t// publisher.subscribe('trackPlayed', (trackIndex, stemCount) => {\n\t// \tif (buttonIndex <= stemCount - 1) {\n\t// \t\tbutton.enable();\n\t// \t\tbutton.activate();\n\t// \t} else {\n\t// \t\tbutton.disable();\n\t// \t\tbutton.deactivate();\n\t// \t}\n\t// })\n\t//\n\t// publisher.subscribe('stemPlayed', (activeIndex) => {\n\t// \tif (activeIndex === buttonIndex) button.activate();\n\t// });\n\n\treturn button;\n}\n\nexport default makeButton;\n","import { query, queryOne } from '@artcommacode/q';\n\n/**\n * Receives a DOM element with links to audio files to be played in tandem as stems.\n * Returns an object with play/pause/mute methods\n * @param  {DOM element} element\n * @return {Stem}\n */\nfunction makeStem(src) {\n\tconst stem = {};\n\tstem.audio = new Audio();\n\n\tstem.load = function loadStem(loadedCallback) {\n\t\tstem.fileName = src.replace(/\\/$/).split('/').pop();\n\t\tconst xhr = new XMLHttpRequest();\n\t\txhr.open('GET', encodeURI(src), true);\n\t\txhr.setRequestHeader('Content-Type', 'application/json');\n\t\txhr.responseType = 'blob';\n\t\txhr.onload = (e) => {\n\t\t\tconst blob = new Blob([xhr.response], { type: 'audio/mp3' });\n\t\t\tconst objectUrl = URL.createObjectURL(blob);\n\t\t\tstem.audio.src = objectUrl;\n\t\t\tstem.audio.onload = () => {\n\t\t\t\tURL.revokeObjectURL(objectUrl);\n\t\t\t};\n\t\t\tstem.ready = true;\n\t\t\tconst error = (e.target.status !== 200) ? `${e.target.status} ${e.target.statusText}` : false;\n\t\t\tloadedCallback(error);\n\t\t};\n\t\txhr.send();\n\t};\n\n\t// const stem = {};\n\t// stem.audio = element;\n\t// stem.active = false;\n\t// const url = stem.audio.getAttribute('src').split('/');\n\t// stem.fileName = url.slice(-1)[0];\n\n\tstem.play = function playStem() {\n\t\tconsole.log(`playing ${stem.fileName}`)\n\t\tif (stem.ready) {\n\t\t\tstem.unmute();\n\t\t\tstem.audio.play();\n\t\t}\n\t\tstem.active = true;\n\t\ttry {\n\t\t\tstem.audio.play();\n\t\t} catch (e) {\n\t\t\t// do nothing\n\t\t}\n\t};\n\n\tstem.reset = function resetStem() {\n\t\tstem.stop();\n\t\tstem.audio.volume = 1;\n\t}\n\n\tstem.stop = function stopStem() {\n\t\tstem.active = false;\n\t\tstem.audio.pause();\n\t\tstem.audio.currentTime = 0;\n\t};\n\n\tstem.unmute = function unmuteStem() {\n\t\tstem.active = true;\n\t\tstem.audio.volume = 1;\n\t};\n\n\tstem.mute = function muteStem() {\n\t\tstem.active = false;\n\t\tstem.audio.volume = 0;\n\t};\n\n\treturn stem;\n}\n\n\nexport default makeStem;\n","import { query, queryOne } from '@artcommacode/q';\nimport makeStem from './Stem';\n\n/**\n * Receives a DOM element with links to audio files to be played in tandem as stems.\n * Returns an object with play/pause/mute methods\n * @param  {DOM element} element\n * @return {Stem}\n */\nfunction makeTrack(el, trackIndex, publisher, readyCallback) {\n\tconst track = {};\n\ttrack.element = el;\n\tconst stemSources = JSON.parse(track.element.getAttribute('data-stems'));\n\n\tconst stems = [];\n\tlet loadedStems = 0;\n\n\t// add each element to the tracks array.\n\tstemSources.map((stemElement) => {\n\t\tconst stem = makeStem(stemElement);\n\t\tstems.push(stem);\n\t});\n\n\t/**\n\t * METHODS\n\t */\n\n\ttrack.play = function playTrack() {\n\t\ttrack.active = true;\n\t\tstems.map(stem => stem.play());\n\t\tpublisher.emit('enableButtons', stems.length);\n\t\ttrack.element.classList.add('playing');\n\t};\n\n\ttrack.stop = function stopTrack() {\n\t\ttrack.active = false;\n\t\tstems.map(stem => stem.reset());\n\t\tpublisher.emit('enableButtons', stems.length);\n\t\ttrack.element.classList.remove('playing');\n\t};\n\n\n\t/**\n\t * FUNCTIONS\n\t */\n\n\n\t/**\n\t * Track the number of loaded stems.\n\t * Set error status if necessary.\n\t */\n\tfunction stemLoadedHandler(err) {\n\t\tloadedStems += 1;\n\t\tif (err) {\n\t\t\ttrack.hasError = true;\n\t\t\ttrack.element.classList.add('has-errors');\n\t\t}\n\t\tif (loadedStems === stems.length) {\n\t\t\ttrack.isLoaded = true;\n\t\t\ttrack.element.classList.remove('loading');\n\t\t\ttrack.element.classList.add('loaded');\n\t\t}\n\t}\n\n\t/**\n\t * If the track hasn't loaded, load the stems. Otherwise, play.\n\t */\n\tfunction handleClick() {\n\t\tif (!track.isLoaded) {\n\t\t\ttrack.element.classList.add('loading');\n\t\t\tstems.map(stem => stem.load(stemLoadedHandler));\n\t\t} else {\n\t\t\tpublisher.emit('trackPlayed', trackIndex);\n\t\t\ttrack.play();\n\t\t}\n\t}\n\n\t/*\n   * EVENTS\n\t */\n\ttrack.element.addEventListener('click', handleClick);\n\n\tpublisher.subscribe('trackPlayed', (newIndex) => {\n\t\tif (newIndex !== trackIndex) {\n\t\t\ttrack.active = false;\n\t\t\ttrack.stop();\n\t\t}\n\t});\n\n\tpublisher.subscribe('stemActivated', (stemIndex) => {\n\t\tif (track.active) stems[stemIndex].unmute();\n\t});\n\n\tpublisher.subscribe('stemDeactivated', (stemIndex) => {\n\t\tif (track.active) stems[stemIndex].mute();\n\t});\n\n\tpublisher.subscribe('allStemsActivated', () => {\n\t\tif (track.active) {\n\t\t\tstems.map(stem => stem.play());\n\t\t\tpublisher.emit('enableButtons', stems.length);\n\t\t}\n\t})\n\n\t/**\n\t * Debug logging\n\t */\n\n\tconst debugOutput = queryOne('#debug-output');\n\n\tpublisher.subscribe('trackPlayed', () => {\n\t\tdebugOutput.innerHTML = '';\n\t});\n\n\tfunction pad(input, padLength = 2, char = '0', direction = 'right') {\n\t\tlet string = input.toString();\n\t\tconst diff = padLength - input.length;\n\t\tfor (let i = 0; i < diff; i += 1) {\n\t\t\tif (direction === 'right') {\n\t\t\t\tstring += char;\n\t\t\t} else {\n\t\t\t\tstring = char + string;\n\t\t\t}\n\t\t}\n\t\treturn string;\n\t}\n\n\tfunction formatDecimal(input, lLength, rLength) {\n\t\tconst arr = input.toString().split('.');\n\t\tif (arr.length === 1) arr.push('0');\n\t\tconst whole = pad(arr[0], lLength, '0', 'left');\n\t\tconst dec = pad(arr[1], rLength, '0', 'right').substr(0, rLength);\n\t\treturn `${whole}.${dec}`;\n\t}\n\n\tsetInterval(() => {\n\t\tif (track.active) {\n\t\t\tconst debugString = ['*******'];\n\t\t\tlet min;\n\t\t\tlet max;\n\t\t\tstems.map((stem, index) => {\n\t\t\t\tif (stem.audio) {\n\t\t\t\t\tconst activated = (stem.active) ? 'activated' : 'deactivated';\n\t\t\t\t\tconst currentTime = Math.round(stem.audio.currentTime * 10000) / 10000;\n\t\t\t\t\tconst formattedTime = formatDecimal(currentTime, 3, 4);\n\n\t\t\t\t\tmin = (min) ? Math.min(min, currentTime) : currentTime;\n\t\t\t\t\tmax = (max) ? Math.max(max, currentTime) : currentTime;\n\t\t\t\t\tif (currentTime === 0) stem.audio.play();\n\t\t\t\t\tdebugString.push(`   stem ${index}: ${formattedTime} | ${stem.fileName} - ${activated} | ${stem.audio.buffered.end(0)} / ${stem.audio.duration}`);\n\t\t\t\t}\n\t\t\t});\n\t\t\tconst diff = formatDecimal(max - min, 1, 6);\n\t\t\tdebugString.push(`   max diff: ${diff}`);\n\t\t\tdebugOutput.innerHTML = debugString.join('<br>');\n\t\t}\n\t}, 100);\n\n\ttrack.stemsCount = stems.length;\n\n\n\treturn track;\n}\n\n\nexport default makeTrack;\n","\nclass PubSubEmitter {\n\tconstructor() {\n\t\t// create a new Map to hold all of the topics\n\t\tthis.listeners = new Map();\n\t}\n\n\tsubscribe(topic, callback) {\n\t\t// if the listener does not hae the topic yet, add it.\n\t\tif (!this.listeners.has(topic)) this.listeners.set(topic, []);\n\t\t// push the callback to the topic's array\n\t\tthis.listeners.get(topic).push(callback);\n\t}\n\n\tunsubscribe(topic, callback) {\n\t\tconst listeners = this.listeners.get(topic);\n\t\tlet index;\n\n\t\tif (listeners && listeners.length) {\n\t\t\t// find the index of the callback we're removing\n\t\t\tindex = listeners.reduce((i, listener, currentIndex) => {\n\t\t\t\t(typeof(listener) === 'function' && listener === callback) ?\n\t\t\t\t\ti = currentIndex :\n\t\t\t\t\ti;\n\t\t\t}, -1);\n\n\t\t\tif (index > -1) {\n\t\t\t\t// if we found a match, splice it out, and resupply the map with the spliced array\n\t\t\t\tlisteners.splice(index, 1);\n\t\t\t\tthis.listeners.set(topic, listeners);\n\t\t\t\treturn true; // return true if we removed something\n\t\t\t}\n\t\t}\n\t\treturn false; // return false if we didn't\n\t}\n\n\temit(topic, ...args) {\n\t\t// get the listeners subscribed to the topic\n\t\tconst listeners = this.listeners.get(topic);\n\n\t\tif (listeners && listeners.length) {\n\t\t\t// execute each callback with any supplied arguments\n\t\t\tlisteners.forEach((listener) => {\n\t\t\t\tlistener(...args);\n\t\t\t});\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n}\n\nconst publisher = new PubSubEmitter();\n\nexport default publisher;\n","// A small utility for getting DOM elements\nimport { query, queryOne } from '@artcommacode/q';\n\n// A component you can use to emit and subscribe to events.\n// Helpful to decouple UI stuff\nimport publisher from './components/publisher';\nimport makeTrack from './components/Track';\nimport makeButton from './components/Button';\n\n// first, just find the elements\nconst trackElements = query('.stem-track');\nconst everything = queryOne('.stem-buttons .play-all') || false;\nconst buttons = [];\nconst tracks = [];\n\nlet readyCount = 0;\n\nfunction readyHandler() {\n\treadyCount += 1;\n\tif (readyCount === tracks.length) {\n\t\tqueryOne('.stems-container').classList.add('ready');\n\t}\n}\n\n// add each composed track to an array\ntrackElements.map((track, index) => {\n\tconst newTrack = makeTrack(track, index, publisher, readyHandler);\n\ttracks.push(newTrack);\n});\n\nquery('.stem-buttons .stem-button').map((button, index) => {\n\tconst newButton = makeButton(button, index, publisher);\n\tbuttons.push(newButton);\n});\n\n/**\n * Event Listeners\n */\n\nif (everything) {\n\teverything.addEventListener('click', () => {\n\t\tpublisher.emit('allStemsActivated');\n\t});\n}\n\n// Use each track element as the source of a Stem object\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJub2RlX21vZHVsZXMvQGFydGNvbW1hY29kZS9xL2luZGV4LmpzIiwic3JjL2pzL2NvbXBvbmVudHMvQnV0dG9uLmpzIiwic3JjL2pzL2NvbXBvbmVudHMvU3RlbS5qcyIsInNyYy9qcy9jb21wb25lbnRzL1RyYWNrLmpzIiwic3JjL2pzL2NvbXBvbmVudHMvcHVibGlzaGVyLmpzIiwic3JjL2pzL3N0ZW1zLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQy9CQTs7Ozs7OztBQU9BLFNBQVMsVUFBVCxDQUFvQixFQUFwQixFQUF3QixXQUF4QixFQUFxQyxTQUFyQyxFQUFnRDtBQUMvQyxLQUFNLFNBQVMsRUFBZjtBQUNBLFFBQU8sT0FBUCxHQUFpQixFQUFqQjs7QUFFQSxRQUFPLE1BQVAsR0FBZ0IsU0FBUyxNQUFULEdBQWtCO0FBQ2pDLFNBQU8sT0FBUCxHQUFpQixJQUFqQjtBQUNBLFNBQU8sT0FBUCxDQUFlLFNBQWYsQ0FBeUIsR0FBekIsQ0FBNkIsU0FBN0I7QUFDQSxFQUhEOztBQUtBLFFBQU8sT0FBUCxHQUFpQixTQUFTLE9BQVQsR0FBbUI7QUFDbkMsU0FBTyxPQUFQLEdBQWlCLEtBQWpCO0FBQ0EsU0FBTyxPQUFQLENBQWUsU0FBZixDQUF5QixNQUF6QixDQUFnQyxTQUFoQztBQUNBLEVBSEQ7O0FBS0EsUUFBTyxhQUFQLEdBQXVCLFNBQVMsYUFBVCxHQUF5QjtBQUMvQyxNQUFJLE9BQU8sT0FBWCxFQUFvQjtBQUNuQixVQUFPLE9BQVA7QUFDQSxHQUZE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OztBQUlBLElBQUksVUFBSixFQUFnQjtBQUNmLFlBQVcsZ0JBQVgsQ0FBNEIsT0FBNUIsRUFBcUMsWUFBTTtBQUMxQyxzQkFBVSxJQUFWLENBQWUsbUJBQWY7QUFDQSxFQUZEO0FBR0E7O0FBRUQiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG5cbmZ1bmN0aW9uIF90b0NvbnN1bWFibGVBcnJheShhcnIpIHsgaWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgeyBmb3IgKHZhciBpID0gMCwgYXJyMiA9IEFycmF5KGFyci5sZW5ndGgpOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7IGFycjJbaV0gPSBhcnJbaV07IH0gcmV0dXJuIGFycjI7IH0gZWxzZSB7IHJldHVybiBBcnJheS5mcm9tKGFycik7IH0gfVxuXG52YXIgdG9BcnJheSA9IGZ1bmN0aW9uIHRvQXJyYXkobGlzdCkge1xuICByZXR1cm4gW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShsaXN0KSk7XG59O1xuXG52YXIgZmlyc3QgPSBmdW5jdGlvbiBmaXJzdCh4cykge1xuICByZXR1cm4geHNbMF07XG59O1xuXG52YXIgZWxlbUVycm9yID0gZnVuY3Rpb24gZWxlbUVycm9yKGUpIHtcbiAgdGhyb3cgbmV3IEVycm9yKFwiXFxcIlwiICsgU3RyaW5nKGUpICsgXCJcXFwiIGRvZXMndCBleGlzdCBpbiB0aGUgZG9jdW1lbnRcIik7XG59O1xuXG52YXIgZ2V0Um9vdCA9IGZ1bmN0aW9uIGdldFJvb3QoZSkge1xuICByZXR1cm4gIWUgPyBkb2N1bWVudCA6IGRvY3VtZW50ICYmIGRvY3VtZW50LmJvZHkgJiYgZG9jdW1lbnQuYm9keS5jb250YWlucyhlKSA/IGUgOiBlbGVtRXJyb3IoZSk7XG59O1xuXG52YXIgcXVlcnkgPSBleHBvcnRzLnF1ZXJ5ID0gZnVuY3Rpb24gcXVlcnkocSwgZSkge1xuICB2YXIgcm9vdCA9IGdldFJvb3QoZSk7XG4gIHJldHVybiByb290ID8gdG9BcnJheShyb290LnF1ZXJ5U2VsZWN0b3JBbGwocSkpIDogW107XG59O1xuXG52YXIgcXVlcnlPbmUgPSBleHBvcnRzLnF1ZXJ5T25lID0gZnVuY3Rpb24gcXVlcnlPbmUocSwgZSkge1xuICByZXR1cm4gZmlyc3QocXVlcnkocSwgZSkpO1xufTtcbiIsIlxuLyoqXG4gKiBSZWNlaXZlcyBhIERPTSBlbGVtZW50LlxuICogUmV0dXJucyBhbiBvYmplY3Qgd2l0aCBlbmFibGUsIGFjdGl2YXRlLCBhbmQgZGVhY3RpdmF0ZSBtZXRob2RzXG4gKiBAcGFyYW0gIHtET00gZWxlbWVudH0gZWxlbWVudFxuICogQHJldHVybiB7U2hhcGV9XG4gKi9cblxuZnVuY3Rpb24gbWFrZUJ1dHRvbihlbCwgYnV0dG9uSW5kZXgsIHB1Ymxpc2hlcikge1xuXHRjb25zdCBidXR0b24gPSB7fTtcblx0YnV0dG9uLmVsZW1lbnQgPSBlbDtcblxuXHRidXR0b24uZW5hYmxlID0gZnVuY3Rpb24gZW5hYmxlKCkge1xuXHRcdGJ1dHRvbi5lbmFibGVkID0gdHJ1ZTtcblx0XHRidXR0b24uZWxlbWVudC5jbGFzc0xpc3QuYWRkKCdlbmFibGVkJyk7XG5cdH07XG5cblx0YnV0dG9uLmRpc2FibGUgPSBmdW5jdGlvbiBkaXNhYmxlKCkge1xuXHRcdGJ1dHRvbi5lbmFibGVkID0gZmFsc2U7XG5cdFx0YnV0dG9uLmVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnZW5hYmxlZCcpO1xuXHR9O1xuXG5cdGJ1dHRvbi50b2dnbGVFbmFibGVkID0gZnVuY3Rpb24gdG9nZ2xlRW5hYmxlZCgpIHtcblx0XHRpZiAoYnV0dG9uLmVuYWJsZWQpIHtcblx0XHRcdGJ1dHRvbi5kaXNhYmxlKCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGJ1dHRvbi5lbmFibGUoKTtcblx0XHR9XG5cdH07XG5cblx0YnV0dG9uLmFjdGl2YXRlID0gZnVuY3Rpb24gYWN0aXZhdGUoKSB7XG5cdFx0aWYgKCFidXR0b24uZW5hYmxlZCkgYnV0dG9uLmVuYWJsZSgpO1xuXHRcdGJ1dHRvbi5hY3RpdmUgPSB0cnVlO1xuXHRcdGJ1dHRvbi5lbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpO1xuXHR9O1xuXG5cdGJ1dHRvbi5kZWFjdGl2YXRlID0gZnVuY3Rpb24gZGVhY3RpdmF0ZSgpIHtcblx0XHRidXR0b24uYWN0aXZlID0gZmFsc2U7XG5cdFx0YnV0dG9uLmVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XG5cdH07XG5cblx0YnV0dG9uLnRvZ2dsZUFjdGl2ZSA9IGZ1bmN0aW9uIHRvZ2dsZUFjdGl2ZShpbnB1dFN0YXRlKSB7XG5cdFx0YnV0dG9uLmFjdGl2ZSA9IGlucHV0U3RhdGUgfHwgIWJ1dHRvbi5hY3RpdmU7XG5cdFx0aWYgKGJ1dHRvbi5hY3RpdmUgPT09IHRydWUpIHtcblx0XHRcdGJ1dHRvbi5hY3RpdmF0ZSgpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRidXR0b24uZGVhY3RpdmF0ZSgpO1xuXHRcdH1cblx0fTtcblxuXHQvKipcblx0ICogRVZFTlRTXG5cdCAqL1xuXG5cdHB1Ymxpc2hlci5zdWJzY3JpYmUoJ2VuYWJsZUJ1dHRvbnMnLCAoY291bnQpID0+IHtcblx0XHRpZiAoYnV0dG9uSW5kZXggPD0gY291bnQgLSAxKSB7XG5cdFx0XHRidXR0b24uZW5hYmxlKCk7XG5cdFx0XHRidXR0b24uYWN0aXZhdGUoKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0YnV0dG9uLmRpc2FibGUoKTtcblx0XHRcdGJ1dHRvbi5kZWFjdGl2YXRlKCk7XG5cdFx0fVxuXHR9KTtcblxuXHRidXR0b24uZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcblx0XHRidXR0b24udG9nZ2xlQWN0aXZlKCk7XG5cdFx0Y29uc3QgZXZlbnQgPSAoYnV0dG9uLmFjdGl2ZSkgPyAnc3RlbUFjdGl2YXRlZCcgOiAnc3RlbURlYWN0aXZhdGVkJztcblx0XHRwdWJsaXNoZXIuZW1pdChldmVudCwgYnV0dG9uSW5kZXgpO1xuXHR9KTtcblx0Ly9cblx0Ly8gcHVibGlzaGVyLnN1YnNjcmliZSgnYWxsQnV0dG9uc0Rpc2FibGVkJywgYnV0dG9uLmRpc2FibGUpO1xuXHQvL1xuXHQvLyBwdWJsaXNoZXIuc3Vic2NyaWJlKCd0cmFja1BsYXllZCcsICh0cmFja0luZGV4LCBzdGVtQ291bnQpID0+IHtcblx0Ly8gXHRpZiAoYnV0dG9uSW5kZXggPD0gc3RlbUNvdW50IC0gMSkge1xuXHQvLyBcdFx0YnV0dG9uLmVuYWJsZSgpO1xuXHQvLyBcdFx0YnV0dG9uLmFjdGl2YXRlKCk7XG5cdC8vIFx0fSBlbHNlIHtcblx0Ly8gXHRcdGJ1dHRvbi5kaXNhYmxlKCk7XG5cdC8vIFx0XHRidXR0b24uZGVhY3RpdmF0ZSgpO1xuXHQvLyBcdH1cblx0Ly8gfSlcblx0Ly9cblx0Ly8gcHVibGlzaGVyLnN1YnNjcmliZSgnc3RlbVBsYXllZCcsIChhY3RpdmVJbmRleCkgPT4ge1xuXHQvLyBcdGlmIChhY3RpdmVJbmRleCA9PT0gYnV0dG9uSW5kZXgpIGJ1dHRvbi5hY3RpdmF0ZSgpO1xuXHQvLyB9KTtcblxuXHRyZXR1cm4gYnV0dG9uO1xufVxuXG5leHBvcnQgZGVmYXVsdCBtYWtlQnV0dG9uO1xuIiwiaW1wb3J0IHsgcXVlcnksIHF1ZXJ5T25lIH0gZnJvbSAnQGFydGNvbW1hY29kZS9xJztcblxuLyoqXG4gKiBSZWNlaXZlcyBhIERPTSBlbGVtZW50IHdpdGggbGlua3MgdG8gYXVkaW8gZmlsZXMgdG8gYmUgcGxheWVkIGluIHRhbmRlbSBhcyBzdGVtcy5cbiAqIFJldHVybnMgYW4gb2JqZWN0IHdpdGggcGxheS9wYXVzZS9tdXRlIG1ldGhvZHNcbiAqIEBwYXJhbSAge0RPTSBlbGVtZW50fSBlbGVtZW50XG4gKiBAcmV0dXJuIHtTdGVtfVxuICovXG5mdW5jdGlvbiBtYWtlU3RlbShzcmMpIHtcblx0Y29uc3Qgc3RlbSA9IHt9O1xuXHRzdGVtLmF1ZGlvID0gbmV3IEF1ZGlvKCk7XG5cblx0c3RlbS5sb2FkID0gZnVuY3Rpb24gbG9hZFN0ZW0obG9hZGVkQ2FsbGJhY2spIHtcblx0XHRzdGVtLmZpbGVOYW1lID0gc3JjLnJlcGxhY2UoL1xcLyQvKS5zcGxpdCgnLycpLnBvcCgpO1xuXHRcdGNvbnN0IHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuXHRcdHhoci5vcGVuKCdHRVQnLCBlbmNvZGVVUkkoc3JjKSwgdHJ1ZSk7XG5cdFx0eGhyLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0eGhyLnJlc3BvbnNlVHlwZSA9ICdibG9iJztcblx0XHR4aHIub25sb2FkID0gKGUpID0+IHtcblx0XHRcdGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbeGhyLnJlc3BvbnNlXSwgeyB0eXBlOiAnYXVkaW8vbXAzJyB9KTtcblx0XHRcdGNvbnN0IG9iamVjdFVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7XG5cdFx0XHRzdGVtLmF1ZGlvLnNyYyA9IG9iamVjdFVybDtcblx0XHRcdHN0ZW0uYXVkaW8ub25sb2FkID0gKCkgPT4ge1xuXHRcdFx0XHRVUkwucmV2b2tlT2JqZWN0VVJMKG9iamVjdFVybCk7XG5cdFx0XHR9O1xuXHRcdFx0c3RlbS5yZWFkeSA9IHRydWU7XG5cdFx0XHRjb25zdCBlcnJvciA9IChlLnRhcmdldC5zdGF0dXMgIT09IDIwMCkgPyBgJHtlLnRhcmdldC5zdGF0dXN9ICR7ZS50YXJnZXQuc3RhdHVzVGV4dH1gIDogZmFsc2U7XG5cdFx0XHRsb2FkZWRDYWxsYmFjayhlcnJvcik7XG5cdFx0fTtcblx0XHR4aHIuc2VuZCgpO1xuXHR9O1xuXG5cdC8vIGNvbnN0IHN0ZW0gPSB7fTtcblx0Ly8gc3RlbS5hdWRpbyA9IGVsZW1lbnQ7XG5cdC8vIHN0ZW0uYWN0aXZlID0gZmFsc2U7XG5cdC8vIGNvbnN0IHVybCA9IHN0ZW0uYXVkaW8uZ2V0QXR0cmlidXRlKCdzcmMnKS5zcGxpdCgnLycpO1xuXHQvLyBzdGVtLmZpbGVOYW1lID0gdXJsLnNsaWNlKC0xKVswXTtcblxuXHRzdGVtLnBsYXkgPSBmdW5jdGlvbiBwbGF5U3RlbSgpIHtcblx0XHRjb25zb2xlLmxvZyhgcGxheWluZyAke3N0ZW0uZmlsZU5hbWV9YClcblx0XHRpZiAoc3RlbS5yZWFkeSkge1xuXHRcdFx0c3RlbS51bm11dGUoKTtcblx0XHRcdHN0ZW0uYXVkaW8ucGxheSgpO1xuXHRcdH1cblx0XHRzdGVtLmFjdGl2ZSA9IHRydWU7XG5cdFx0dHJ5IHtcblx0XHRcdHN0ZW0uYXVkaW8ucGxheSgpO1xuXHRcdH0gY2F0Y2ggKGUpIHtcblx0XHRcdC8vIGRvIG5vdGhpbmdcblx0XHR9XG5cdH07XG5cblx0c3RlbS5yZXNldCA9IGZ1bmN0aW9uIHJlc2V0U3RlbSgpIHtcblx0XHRzdGVtLnN0b3AoKTtcblx0XHRzdGVtLmF1ZGlvLnZvbHVtZSA9IDE7XG5cdH1cblxuXHRzdGVtLnN0b3AgPSBmdW5jdGlvbiBzdG9wU3RlbSgpIHtcblx0XHRzdGVtLmFjdGl2ZSA9IGZhbHNlO1xuXHRcdHN0ZW0uYXVkaW8ucGF1c2UoKTtcblx0XHRzdGVtLmF1ZGlvLmN1cnJlbnRUaW1lID0gMDtcblx0fTtcblxuXHRzdGVtLnVubXV0ZSA9IGZ1bmN0aW9uIHVubXV0ZVN0ZW0oKSB7XG5cdFx0c3RlbS5hY3RpdmUgPSB0cnVlO1xuXHRcdHN0ZW0uYXVkaW8udm9sdW1lID0gMTtcblx0fTtcblxuXHRzdGVtLm11dGUgPSBmdW5jdGlvbiBtdXRlU3RlbSgpIHtcblx0XHRzdGVtLmFjdGl2ZSA9IGZhbHNlO1xuXHRcdHN0ZW0uYXVkaW8udm9sdW1lID0gMDtcblx0fTtcblxuXHRyZXR1cm4gc3RlbTtcbn1cblxuXG5leHBvcnQgZGVmYXVsdCBtYWtlU3RlbTtcbiIsImltcG9ydCB7IHF1ZXJ5LCBxdWVyeU9uZSB9IGZyb20gJ0BhcnRjb21tYWNvZGUvcSc7XG5pbXBvcnQgbWFrZVN0ZW0gZnJvbSAnLi9TdGVtJztcblxuLyoqXG4gKiBSZWNlaXZlcyBhIERPTSBlbGVtZW50IHdpdGggbGlua3MgdG8gYXVkaW8gZmlsZXMgdG8gYmUgcGxheWVkIGluIHRhbmRlbSBhcyBzdGVtcy5cbiAqIFJldHVybnMgYW4gb2JqZWN0IHdpdGggcGxheS9wYXVzZS9tdXRlIG1ldGhvZHNcbiAqIEBwYXJhbSAge0RPTSBlbGVtZW50fSBlbGVtZW50XG4gKiBAcmV0dXJuIHtTdGVtfVxuICovXG5mdW5jdGlvbiBtYWtlVHJhY2soZWwsIHRyYWNrSW5kZXgsIHB1Ymxpc2hlciwgcmVhZHlDYWxsYmFjaykge1xuXHRjb25zdCB0cmFjayA9IHt9O1xuXHR0cmFjay5lbGVtZW50ID0gZWw7XG5cdGNvbnN0IHN0ZW1Tb3VyY2VzID0gSlNPTi5wYXJzZSh0cmFjay5lbGVtZW50LmdldEF0dHJpYnV0ZSgnZGF0YS1zdGVtcycpKTtcblxuXHRjb25zdCBzdGVtcyA9IFtdO1xuXHRsZXQgbG9hZGVkU3RlbXMgPSAwO1xuXG5cdC8vIGFkZCBlYWNoIGVsZW1lbnQgdG8gdGhlIHRyYWNrcyBhcnJheS5cblx0c3RlbVNvdXJjZXMubWFwKChzdGVtRWxlbWVudCkgPT4ge1xuXHRcdGNvbnN0IHN0ZW0gPSBtYWtlU3RlbShzdGVtRWxlbWVudCk7XG5cdFx0c3RlbXMucHVzaChzdGVtKTtcblx0fSk7XG5cblx0LyoqXG5cdCAqIE1FVEhPRFNcblx0ICovXG5cblx0dHJhY2sucGxheSA9IGZ1bmN0aW9uIHBsYXlUcmFjaygpIHtcblx0XHR0cmFjay5hY3RpdmUgPSB0cnVlO1xuXHRcdHN0ZW1zLm1hcChzdGVtID0+IHN0ZW0ucGxheSgpKTtcblx0XHRwdWJsaXNoZXIuZW1pdCgnZW5hYmxlQnV0dG9ucycsIHN0ZW1zLmxlbmd0aCk7XG5cdFx0dHJhY2suZWxlbWVudC5jbGFzc0xpc3QuYWRkKCdwbGF5aW5nJyk7XG5cdH07XG5cblx0dHJhY2suc3RvcCA9IGZ1bmN0aW9uIHN0b3BUcmFjaygpIHtcblx0XHR0cmFjay5hY3RpdmUgPSBmYWxzZTtcblx0XHRzdGVtcy5tYXAoc3RlbSA9PiBzdGVtLnJlc2V0KCkpO1xuXHRcdHB1Ymxpc2hlci5lbWl0KCdlbmFibGVCdXR0b25zJywgc3RlbXMubGVuZ3RoKTtcblx0XHR0cmFjay5lbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ3BsYXlpbmcnKTtcblx0fTtcblxuXG5cdC8qKlxuXHQgKiBGVU5DVElPTlNcblx0ICovXG5cblxuXHQvKipcblx0ICogVHJhY2sgdGhlIG51bWJlciBvZiBsb2FkZWQgc3RlbXMuXG5cdCAqIFNldCBlcnJvciBzdGF0dXMgaWYgbmVjZXNzYXJ5LlxuXHQgKi9cblx0ZnVuY3Rpb24gc3RlbUxvYWRlZEhhbmRsZXIoZXJyKSB7XG5cdFx0bG9hZGVkU3RlbXMgKz0gMTtcblx0XHRpZiAoZXJyKSB7XG5cdFx0XHR0cmFjay5oYXNFcnJvciA9IHRydWU7XG5cdFx0XHR0cmFjay5lbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2hhcy1lcnJvcnMnKTtcblx0XHR9XG5cdFx0aWYgKGxvYWRlZFN0ZW1zID09PSBzdGVtcy5sZW5ndGgpIHtcblx0XHRcdHRyYWNrLmlzTG9hZGVkID0gdHJ1ZTtcblx0XHRcdHRyYWNrLmVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnbG9hZGluZycpO1xuXHRcdFx0dHJhY2suZWxlbWVudC5jbGFzc0xpc3QuYWRkKCdsb2FkZWQnKTtcblx0XHR9XG5cdH1cblxuXHQvKipcblx0ICogSWYgdGhlIHRyYWNrIGhhc24ndCBsb2FkZWQsIGxvYWQgdGhlIHN0ZW1zLiBPdGhlcndpc2UsIHBsYXkuXG5cdCAqL1xuXHRmdW5jdGlvbiBoYW5kbGVDbGljaygpIHtcblx0XHRpZiAoIXRyYWNrLmlzTG9hZGVkKSB7XG5cdFx0XHR0cmFjay5lbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2xvYWRpbmcnKTtcblx0XHRcdHN0ZW1zLm1hcChzdGVtID0+IHN0ZW0ubG9hZChzdGVtTG9hZGVkSGFuZGxlcikpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRwdWJsaXNoZXIuZW1pdCgndHJhY2tQbGF5ZWQnLCB0cmFja0luZGV4KTtcblx0XHRcdHRyYWNrLnBsYXkoKTtcblx0XHR9XG5cdH1cblxuXHQvKlxuICAgKiBFVkVOVFNcblx0ICovXG5cdHRyYWNrLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVDbGljayk7XG5cblx0cHVibGlzaGVyLnN1YnNjcmliZSgndHJhY2tQbGF5ZWQnLCAobmV3SW5kZXgpID0+IHtcblx0XHRpZiAobmV3SW5kZXggIT09IHRyYWNrSW5kZXgpIHtcblx0XHRcdHRyYWNrLmFjdGl2ZSA9IGZhbHNlO1xuXHRcdFx0dHJhY2suc3RvcCgpO1xuXHRcdH1cblx0fSk7XG5cblx0cHVibGlzaGVyLnN1YnNjcmliZSgnc3RlbUFjdGl2YXRlZCcsIChzdGVtSW5kZXgpID0+IHtcblx0XHRpZiAodHJhY2suYWN0aXZlKSBzdGVtc1tzdGVtSW5kZXhdLnVubXV0ZSgpO1xuXHR9KTtcblxuXHRwdWJsaXNoZXIuc3Vic2NyaWJlKCdzdGVtRGVhY3RpdmF0ZWQnLCAoc3RlbUluZGV4KSA9PiB7XG5cdFx0aWYgKHRyYWNrLmFjdGl2ZSkgc3RlbXNbc3RlbUluZGV4XS5tdXRlKCk7XG5cdH0pO1xuXG5cdHB1Ymxpc2hlci5zdWJzY3JpYmUoJ2FsbFN0ZW1zQWN0aXZhdGVkJywgKCkgPT4ge1xuXHRcdGlmICh0cmFjay5hY3RpdmUpIHtcblx0XHRcdHN0ZW1zLm1hcChzdGVtID0+IHN0ZW0ucGxheSgpKTtcblx0XHRcdHB1Ymxpc2hlci5lbWl0KCdlbmFibGVCdXR0b25zJywgc3RlbXMubGVuZ3RoKTtcblx0XHR9XG5cdH0pXG5cblx0LyoqXG5cdCAqIERlYnVnIGxvZ2dpbmdcblx0ICovXG5cblx0Y29uc3QgZGVidWdPdXRwdXQgPSBxdWVyeU9uZSgnI2RlYnVnLW91dHB1dCcpO1xuXG5cdHB1Ymxpc2hlci5zdWJzY3JpYmUoJ3RyYWNrUGxheWVkJywgKCkgPT4ge1xuXHRcdGRlYnVnT3V0cHV0LmlubmVySFRNTCA9ICcnO1xuXHR9KTtcblxuXHRmdW5jdGlvbiBwYWQoaW5wdXQsIHBhZExlbmd0aCA9IDIsIGNoYXIgPSAnMCcsIGRpcmVjdGlvbiA9ICdyaWdodCcpIHtcblx0XHRsZXQgc3RyaW5nID0gaW5wdXQudG9TdHJpbmcoKTtcblx0XHRjb25zdCBkaWZmID0gcGFkTGVuZ3RoIC0gaW5wdXQubGVuZ3RoO1xuXHRcdGZvciAobGV0IGkgPSAwOyBpIDwgZGlmZjsgaSArPSAxKSB7XG5cdFx0XHRpZiAoZGlyZWN0aW9uID09PSAncmlnaHQnKSB7XG5cdFx0XHRcdHN0cmluZyArPSBjaGFyO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0c3RyaW5nID0gY2hhciArIHN0cmluZztcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHN0cmluZztcblx0fVxuXG5cdGZ1bmN0aW9uIGZvcm1hdERlY2ltYWwoaW5wdXQsIGxMZW5ndGgsIHJMZW5ndGgpIHtcblx0XHRjb25zdCBhcnIgPSBpbnB1dC50b1N0cmluZygpLnNwbGl0KCcuJyk7XG5cdFx0aWYgKGFyci5sZW5ndGggPT09IDEpIGFyci5wdXNoKCcwJyk7XG5cdFx0Y29uc3Qgd2hvbGUgPSBwYWQoYXJyWzBdLCBsTGVuZ3RoLCAnMCcsICdsZWZ0Jyk7XG5cdFx0Y29uc3QgZGVjID0gcGFkKGFyclsxXSwgckxlbmd0aCwgJzAnLCAncmlnaHQnKS5zdWJzdHIoMCwgckxlbmd0aCk7XG5cdFx0cmV0dXJuIGAke3dob2xlfS4ke2RlY31gO1xuXHR9XG5cblx0c2V0SW50ZXJ2YWwoKCkgPT4ge1xuXHRcdGlmICh0cmFjay5hY3RpdmUpIHtcblx0XHRcdGNvbnN0IGRlYnVnU3RyaW5nID0gWycqKioqKioqJ107XG5cdFx0XHRsZXQgbWluO1xuXHRcdFx0bGV0IG1heDtcblx0XHRcdHN0ZW1zLm1hcCgoc3RlbSwgaW5kZXgpID0+IHtcblx0XHRcdFx0aWYgKHN0ZW0uYXVkaW8pIHtcblx0XHRcdFx0XHRjb25zdCBhY3RpdmF0ZWQgPSAoc3RlbS5hY3RpdmUpID8gJ2FjdGl2YXRlZCcgOiAnZGVhY3RpdmF0ZWQnO1xuXHRcdFx0XHRcdGNvbnN0IGN1cnJlbnRUaW1lID0gTWF0aC5yb3VuZChzdGVtLmF1ZGlvLmN1cnJlbnRUaW1lICogMTAwMDApIC8gMTAwMDA7XG5cdFx0XHRcdFx0Y29uc3QgZm9ybWF0dGVkVGltZSA9IGZvcm1hdERlY2ltYWwoY3VycmVudFRpbWUsIDMsIDQpO1xuXG5cdFx0XHRcdFx0bWluID0gKG1pbikgPyBNYXRoLm1pbihtaW4sIGN1cnJlbnRUaW1lKSA6IGN1cnJlbnRUaW1lO1xuXHRcdFx0XHRcdG1heCA9IChtYXgpID8gTWF0aC5tYXgobWF4LCBjdXJyZW50VGltZSkgOiBjdXJyZW50VGltZTtcblx0XHRcdFx0XHRpZiAoY3VycmVudFRpbWUgPT09IDApIHN0ZW0uYXVkaW8ucGxheSgpO1xuXHRcdFx0XHRcdGRlYnVnU3RyaW5nLnB1c2goYCAgIHN0ZW0gJHtpbmRleH06ICR7Zm9ybWF0dGVkVGltZX0gfCAke3N0ZW0uZmlsZU5hbWV9IC0gJHthY3RpdmF0ZWR9IHwgJHtzdGVtLmF1ZGlvLmJ1ZmZlcmVkLmVuZCgwKX0gLyAke3N0ZW0uYXVkaW8uZHVyYXRpb259YCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdFx0Y29uc3QgZGlmZiA9IGZvcm1hdERlY2ltYWwobWF4IC0gbWluLCAxLCA2KTtcblx0XHRcdGRlYnVnU3RyaW5nLnB1c2goYCAgIG1heCBkaWZmOiAke2RpZmZ9YCk7XG5cdFx0XHRkZWJ1Z091dHB1dC5pbm5lckhUTUwgPSBkZWJ1Z1N0cmluZy5qb2luKCc8YnI+Jyk7XG5cdFx0fVxuXHR9LCAxMDApO1xuXG5cdHRyYWNrLnN0ZW1zQ291bnQgPSBzdGVtcy5sZW5ndGg7XG5cblxuXHRyZXR1cm4gdHJhY2s7XG59XG5cblxuZXhwb3J0IGRlZmF1bHQgbWFrZVRyYWNrO1xuIiwiXG5jbGFzcyBQdWJTdWJFbWl0dGVyIHtcblx0Y29uc3RydWN0b3IoKSB7XG5cdFx0Ly8gY3JlYXRlIGEgbmV3IE1hcCB0byBob2xkIGFsbCBvZiB0aGUgdG9waWNzXG5cdFx0dGhpcy5saXN0ZW5lcnMgPSBuZXcgTWFwKCk7XG5cdH1cblxuXHRzdWJzY3JpYmUodG9waWMsIGNhbGxiYWNrKSB7XG5cdFx0Ly8gaWYgdGhlIGxpc3RlbmVyIGRvZXMgbm90IGhhZSB0aGUgdG9waWMgeWV0LCBhZGQgaXQuXG5cdFx0aWYgKCF0aGlzLmxpc3RlbmVycy5oYXModG9waWMpKSB0aGlzLmxpc3RlbmVycy5zZXQodG9waWMsIFtdKTtcblx0XHQvLyBwdXNoIHRoZSBjYWxsYmFjayB0byB0aGUgdG9waWMncyBhcnJheVxuXHRcdHRoaXMubGlzdGVuZXJzLmdldCh0b3BpYykucHVzaChjYWxsYmFjayk7XG5cdH1cblxuXHR1bnN1YnNjcmliZSh0b3BpYywgY2FsbGJhY2spIHtcblx0XHRjb25zdCBsaXN0ZW5lcnMgPSB0aGlzLmxpc3RlbmVycy5nZXQodG9waWMpO1xuXHRcdGxldCBpbmRleDtcblxuXHRcdGlmIChsaXN0ZW5lcnMgJiYgbGlzdGVuZXJzLmxlbmd0aCkge1xuXHRcdFx0Ly8gZmluZCB0aGUgaW5kZXggb2YgdGhlIGNhbGxiYWNrIHdlJ3JlIHJlbW92aW5nXG5cdFx0XHRpbmRleCA9IGxpc3RlbmVycy5yZWR1Y2UoKGksIGxpc3RlbmVyLCBjdXJyZW50SW5kZXgpID0+IHtcblx0XHRcdFx0KHR5cGVvZihsaXN0ZW5lcikgPT09ICdmdW5jdGlvbicgJiYgbGlzdGVuZXIgPT09IGNhbGxiYWNrKSA/XG5cdFx0XHRcdFx0aSA9IGN1cnJlbnRJbmRleCA6XG5cdFx0XHRcdFx0aTtcblx0XHRcdH0sIC0xKTtcblxuXHRcdFx0aWYgKGluZGV4ID4gLTEpIHtcblx0XHRcdFx0Ly8gaWYgd2UgZm91bmQgYSBtYXRjaCwgc3BsaWNlIGl0IG91dCwgYW5kIHJlc3VwcGx5IHRoZSBtYXAgd2l0aCB0aGUgc3BsaWNlZCBhcnJheVxuXHRcdFx0XHRsaXN0ZW5lcnMuc3BsaWNlKGluZGV4LCAxKTtcblx0XHRcdFx0dGhpcy5saXN0ZW5lcnMuc2V0KHRvcGljLCBsaXN0ZW5lcnMpO1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZTsgLy8gcmV0dXJuIHRydWUgaWYgd2UgcmVtb3ZlZCBzb21ldGhpbmdcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIGZhbHNlOyAvLyByZXR1cm4gZmFsc2UgaWYgd2UgZGlkbid0XG5cdH1cblxuXHRlbWl0KHRvcGljLCAuLi5hcmdzKSB7XG5cdFx0Ly8gZ2V0IHRoZSBsaXN0ZW5lcnMgc3Vic2NyaWJlZCB0byB0aGUgdG9waWNcblx0XHRjb25zdCBsaXN0ZW5lcnMgPSB0aGlzLmxpc3RlbmVycy5nZXQodG9waWMpO1xuXG5cdFx0aWYgKGxpc3RlbmVycyAmJiBsaXN0ZW5lcnMubGVuZ3RoKSB7XG5cdFx0XHQvLyBleGVjdXRlIGVhY2ggY2FsbGJhY2sgd2l0aCBhbnkgc3VwcGxpZWQgYXJndW1lbnRzXG5cdFx0XHRsaXN0ZW5lcnMuZm9yRWFjaCgobGlzdGVuZXIpID0+IHtcblx0XHRcdFx0bGlzdGVuZXIoLi4uYXJncyk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiB0cnVlO1xuXHRcdH1cblx0XHRyZXR1cm4gZmFsc2U7XG5cdH1cbn1cblxuY29uc3QgcHVibGlzaGVyID0gbmV3IFB1YlN1YkVtaXR0ZXIoKTtcblxuZXhwb3J0IGRlZmF1bHQgcHVibGlzaGVyO1xuIiwiLy8gQSBzbWFsbCB1dGlsaXR5IGZvciBnZXR0aW5nIERPTSBlbGVtZW50c1xuaW1wb3J0IHsgcXVlcnksIHF1ZXJ5T25lIH0gZnJvbSAnQGFydGNvbW1hY29kZS9xJztcblxuLy8gQSBjb21wb25lbnQgeW91IGNhbiB1c2UgdG8gZW1pdCBhbmQgc3Vic2NyaWJlIHRvIGV2ZW50cy5cbi8vIEhlbHBmdWwgdG8gZGVjb3VwbGUgVUkgc3R1ZmZcbmltcG9ydCBwdWJsaXNoZXIgZnJvbSAnLi9jb21wb25lbnRzL3B1Ymxpc2hlcic7XG5pbXBvcnQgbWFrZVRyYWNrIGZyb20gJy4vY29tcG9uZW50cy9UcmFjayc7XG5pbXBvcnQgbWFrZUJ1dHRvbiBmcm9tICcuL2NvbXBvbmVudHMvQnV0dG9uJztcblxuLy8gZmlyc3QsIGp1c3QgZmluZCB0aGUgZWxlbWVudHNcbmNvbnN0IHRyYWNrRWxlbWVudHMgPSBxdWVyeSgnLnN0ZW0tdHJhY2snKTtcbmNvbnN0IGV2ZXJ5dGhpbmcgPSBxdWVyeU9uZSgnLnN0ZW0tYnV0dG9ucyAucGxheS1hbGwnKSB8fCBmYWxzZTtcbmNvbnN0IGJ1dHRvbnMgPSBbXTtcbmNvbnN0IHRyYWNrcyA9IFtdO1xuXG5sZXQgcmVhZHlDb3VudCA9IDA7XG5cbmZ1bmN0aW9uIHJlYWR5SGFuZGxlcigpIHtcblx0cmVhZHlDb3VudCArPSAxO1xuXHRpZiAocmVhZHlDb3VudCA9PT0gdHJhY2tzLmxlbmd0aCkge1xuXHRcdHF1ZXJ5T25lKCcuc3RlbXMtY29udGFpbmVyJykuY2xhc3NMaXN0LmFkZCgncmVhZHknKTtcblx0fVxufVxuXG4vLyBhZGQgZWFjaCBjb21wb3NlZCB0cmFjayB0byBhbiBhcnJheVxudHJhY2tFbGVtZW50cy5tYXAoKHRyYWNrLCBpbmRleCkgPT4ge1xuXHRjb25zdCBuZXdUcmFjayA9IG1ha2VUcmFjayh0cmFjaywgaW5kZXgsIHB1Ymxpc2hlciwgcmVhZHlIYW5kbGVyKTtcblx0dHJhY2tzLnB1c2gobmV3VHJhY2spO1xufSk7XG5cbnF1ZXJ5KCcuc3RlbS1idXR0b25zIC5zdGVtLWJ1dHRvbicpLm1hcCgoYnV0dG9uLCBpbmRleCkgPT4ge1xuXHRjb25zdCBuZXdCdXR0b24gPSBtYWtlQnV0dG9uKGJ1dHRvbiwgaW5kZXgsIHB1Ymxpc2hlcik7XG5cdGJ1dHRvbnMucHVzaChuZXdCdXR0b24pO1xufSk7XG5cbi8qKlxuICogRXZlbnQgTGlzdGVuZXJzXG4gKi9cblxuaWYgKGV2ZXJ5dGhpbmcpIHtcblx0ZXZlcnl0aGluZy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcblx0XHRwdWJsaXNoZXIuZW1pdCgnYWxsU3RlbXNBY3RpdmF0ZWQnKTtcblx0fSk7XG59XG5cbi8vIFVzZSBlYWNoIHRyYWNrIGVsZW1lbnQgYXMgdGhlIHNvdXJjZSBvZiBhIFN0ZW0gb2JqZWN0XG4iXX0="}