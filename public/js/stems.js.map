{"version":3,"sources":["node_modules/browser-pack/_prelude.js","node_modules/@artcommacode/q/index.js","src/js/components/Button.js","src/js/components/Stem.js","src/js/components/Track.js","src/js/components/publisher.js","src/js/stems.js"],"names":[],"mappings":"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","file":"stems.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\nvar toArray = function toArray(list) {\n  return [].concat(_toConsumableArray(list));\n};\n\nvar first = function first(xs) {\n  return xs[0];\n};\n\nvar elemError = function elemError(e) {\n  throw new Error(\"\\\"\" + String(e) + \"\\\" does't exist in the document\");\n};\n\nvar getRoot = function getRoot(e) {\n  return !e ? document : document && document.body && document.body.contains(e) ? e : elemError(e);\n};\n\nvar query = exports.query = function query(q, e) {\n  var root = getRoot(e);\n  return root ? toArray(root.querySelectorAll(q)) : [];\n};\n\nvar queryOne = exports.queryOne = function queryOne(q, e) {\n  return first(query(q, e));\n};\n","\n/**\n * Receives a DOM element.\n * Returns an object with enable, activate, and deactivate methods\n * @param  {DOM element} element\n * @return {Shape}\n */\n\nfunction makeButton(el, buttonIndex, publisher) {\n\tconst button = {};\n\tbutton.element = el;\n\n\tbutton.enable = function enable() {\n\t\tbutton.enabled = true;\n\t\tbutton.element.classList.add('enabled');\n\t};\n\n\tbutton.disable = function disable() {\n\t\tbutton.enabled = false;\n\t\tbutton.element.classList.remove('enabled');\n\t};\n\n\tbutton.toggleEnabled = function toggleEnabled() {\n\t\tif (button.enabled) {\n\t\t\tbutton.disable();\n\t\t} else {\n\t\t\tbutton.enable();\n\t\t}\n\t};\n\n\tbutton.activate = function activate() {\n\t\tif (!button.enabled) button.enable();\n\t\tbutton.active = true;\n\t\tbutton.element.classList.add('active');\n\t};\n\n\tbutton.deactivate = function deactivate() {\n\t\tbutton.active = false;\n\t\tbutton.element.classList.remove('active');\n\t};\n\n\tbutton.toggleActive = function toggleActive(inputState) {\n\t\tbutton.active = inputState || !button.active;\n\t\tif (button.active === true) {\n\t\t\tbutton.activate();\n\t\t} else {\n\t\t\tbutton.deactivate();\n\t\t}\n\t};\n\n\tbutton.element.addEventListener('click', () => {\n\t\tbutton.toggleActive();\n\t\tconst event = (button.active) ? 'stemActivated' : 'stemDeactivated';\n\t\tpublisher.emit(event, buttonIndex);\n\t});\n\n\tpublisher.subscribe('allButtonsDisabled', button.disable);\n\n\tpublisher.subscribe('trackPlayed', (trackIndex, stemCount) => {\n\t\tif (buttonIndex <= stemCount - 1) {\n\t\t\tbutton.enable();\n\t\t\tbutton.activate();\n\t\t} else {\n\t\t\tbutton.disable();\n\t\t\tbutton.deactivate();\n\t\t}\n\t})\n\n\tpublisher.subscribe('stemPlayed', (activeIndex) => {\n\t\tif (activeIndex === buttonIndex) button.activate();\n\t});\n\n\treturn button;\n}\n\nexport default makeButton;\n","import { query, queryOne } from '@artcommacode/q';\n\n/**\n * Receives a DOM element with links to audio files to be played in tandem as stems.\n * Returns an object with play/pause/mute methods\n * @param  {DOM element} element\n * @return {Stem}\n */\nfunction makeStem(element) {\n\tconst stem = {};\n\tstem.audio = element;\n\tstem.active = false;\n\tconst url = stem.audio.getAttribute('src').split('/');\n\tstem.fileName = url.slice(-1)[0];\n\n\tstem.play = function playStem() {\n\t\tstem.active = true;\n\t\ttry {\n\t\t\tstem.audio.play();\n\t\t} catch (e) {\n\t\t\t// do nothing\n\t\t}\n\t};\n\n\tstem.stop = function stopStem() {\n\t\tstem.active = false;\n\t\tstem.audio.pause();\n\t\tstem.audio.currentTime = 0;\n\t};\n\n\tstem.unmute = function unmuteStem() {\n\t\tstem.active = true;\n\t\tstem.audio.volume = 1;\n\t};\n\n\tstem.mute = function muteStem() {\n\t\tstem.active = false;\n\t\tstem.audio.volume = 0;\n\t};\n\n\treturn stem;\n}\n\n\nexport default makeStem;\n","import { query, queryOne } from '@artcommacode/q';\nimport makeStem from './Stem';\n\n/**\n * Receives a DOM element with links to audio files to be played in tandem as stems.\n * Returns an object with play/pause/mute methods\n * @param  {DOM element} element\n * @return {Stem}\n */\nfunction makeTrack(el, trackIndex, publisher, readyCallback) {\n\tconst track = {};\n\ttrack.element = el;\n\tconst stemElements = query('audio', el);\n\n\tconst stems = [];\n\n\t// See if all of the tracks are ready\n\n\tfunction checkIfReady() {\n\t\tconst readyCount = stems.filter(stem => stem.isReady).length;\n\n\t\tif (readyCount === stems.length) {\n\t\t\ttrack.ready = true;\n\t\t\t// reports back to the main script, so it can count all of the loaded tracks\n\t\t\treadyCallback(trackIndex);\n\t\t\tif (!track.hasErrors) {\n\t\t\t\ttrack.element.classList.add('ready');\n\t\t\t} else {\n\t\t\t\ttrack.element.classList.add('has-errors');\n\t\t\t}\n\t\t}\n\t}\n\n\t// add each element to the tracks array.\n\t// When it's loaded, report it.\n\t// If there is a network error, flag the track\n\tstemElements.map((stemElement) => {\n\t\tconst stem = makeStem(stemElement);\n\t\tconst url = stemElement.getAttribute('src').split('/');\n\t\tstem.fileName = url.slice(-1)[0];\n\t\tstems.push(stem);\n\n\t\tstem.audio.load();\n\n\t\tfunction canPlayThroughHandler() {\n\t\t\t// console.log(`${trackIndex} - ${stem.fileName} is ready`)\n\t\t\tstem.isReady = true;\n\t\t\tstem.audio.removeEventListener('canplaythrough', canPlayThroughHandler);\n\t\t\tcheckIfReady();\n\t\t}\n\n\t\tstem.audio.addEventListener('canplaythrough', canPlayThroughHandler);\n\n\t\tstem.audio.addEventListener('error', (e) => {\n\t\t\tif (e.target.error.code === 3 || e.target.error.code === 4) {\n\t\t\t\tconsole.warn(`${stem.fileName} could not be loaded`);\n\t\t\t\tstem.isReady = true;\n\t\t\t\ttrack.hasErrors = true;\n\t\t\t\tcheckIfReady();\n\t\t\t}\n\t\t});\n\t});\n\n\t// functions that we attach to the 'track' object are public &\n\t// usable from the outside.\n\t// Everything else is private.\n\n\n\tfunction playAllStems() {\n\t\tstems.map((stem, index) => {\n\t\t\tstem.unmute();\n\t\t\tpublisher.emit('stemPlayed', index);\n\t\t});\n\t}\n\n\n\tconst startSynced = () => new Promise((resolve, reject) => {\n\t\tstems.map(stem => stem.mute());\n\t\tfunction checkSync() {\n\t\t\tstems.map(stem => stem.play());\n\t\t\tconst minMax = stems.reduce((previous, current) => {\n\t\t\t\treturn {\n\t\t\t\t\tmin: Math.min(previous.min || current.audio.currentTime, current.audio.currentTime),\n\t\t\t\t\tmax: Math.max(previous.max || current.audio.currentTime, current.audio.currentTime),\n\t\t\t\t};\n\t\t\t}, { min: undefined, max: undefined });\n\t\t\tconst diff = minMax.max - minMax.min;\n\t\t\tif (minMax.max === 0) {\n\t\t\t\tconsole.log('Not ready.. trying again');\n\t\t\t\tsetTimeout(checkSync, 1000);\n\t\t\t} else if (diff < 0.05) {\n\t\t\t\tconsole.log(`starting with diff of ${diff}`);\n\t\t\t\tstems.map(stem => stem.stop());\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tplayAllStems();\n\t\t\t\t\tresolve();\n\t\t\t\t}, 250);\n\t\t\t} else {\n\t\t\t\tconsole.log(`diff: ${diff}  - trying again..`);\n\t\t\t\tstems.map(stem => stem.stop());\n\t\t\t\tsetTimeout(checkSync, 1000);\n\t\t\t}\n\t\t}\n\t\tsetTimeout(checkSync, 1000);\n\t});\n\n\tfunction play() {\n\t\ttrack.active = true;\n\t\ttrack.element.classList.add('loading');\n\t\t// don't do anything if it's not ready. The user shouldn't be\n\t\t// able to play the track until it's ready anyway, though.\n\t\tif (!track.ready) return false;\n\t\t// const isSynced = startSynced();\n\t\tstartSynced().then(() => {\n\t\t\ttrack.element.classList.remove('loading');\n\t\t\ttrack.element.classList.add('playing');\n\t\t\tpublisher.emit('trackPlayed', trackIndex, stems.length);\n\t\t});\n\t\treturn true;\n\t}\n\n\tfunction stop() {\n\t\tstems.map(stem => stem.stop());\n\t\ttrack.active = false;\n\t\ttrack.element.classList.remove('playing');\n\t}\n\n\t/**\n\t * Bind event listeners & emitters\n\t */\n\n\ttrack.element.addEventListener('click', play);\n\n\tpublisher.subscribe('trackPlayed', (newIndex) => {\n\t\tif (newIndex === trackIndex) {\n\t\t\tif (!track.active) play();\n\t\t} else {\n\t\t\tstop();\n\t\t}\n\t});\n\n\tpublisher.subscribe('stemActivated', (stemIndex) => {\n\t\tif (track.active) stems[stemIndex].unmute();\n\t});\n\tpublisher.subscribe('stemDeactivated', (stemIndex) => {\n\t\tconsole.log(stemIndex, track.active);\n\t\tif (track.active) stems[stemIndex].mute();\n\t});\n\n\tpublisher.subscribe('allStemsActivated', playAllStems);\n\n\t/**\n\t * Debug logging\n\t */\n\n\tconst debugOutput = queryOne('#debug-output');\n\n\tpublisher.subscribe('trackPlayed', () => {\n\t\tdebugOutput.innerHTML = '';\n\t});\n\n\tfunction pad(input, padLength = 2, char = '0', direction = 'right') {\n\t\tlet string = input.toString();\n\t\tconst diff = padLength - input.length;\n\t\tfor (let i = 0; i < diff; i += 1) {\n\t\t\tif (direction === 'right') {\n\t\t\t\tstring += char;\n\t\t\t} else {\n\t\t\t\tstring = char + string;\n\t\t\t}\n\t\t}\n\t\treturn string;\n\t}\n\n\tfunction formatDecimal(input, lLength, rLength) {\n\t\tconst arr = input.toString().split('.');\n\t\tif (arr.length === 1) arr.push('0');\n\t\tconst whole = pad(arr[0], lLength, '0', 'left');\n\t\tconst dec = pad(arr[1], rLength, '0', 'right').substr(0, rLength);\n\t\treturn `${whole}.${dec}`;\n\t}\n\n\tsetInterval(() => {\n\t\tif (track.active) {\n\t\t\tconst debugString = ['*******'];\n\t\t\tlet min;\n\t\t\tlet max;\n\t\t\tstems.map((stem, index) => {\n\t\t\t\tif (stem.audio) {\n\t\t\t\t\tconst activated = (stem.active) ? 'activated' : 'deactivated';\n\t\t\t\t\tconst currentTime = Math.round(stem.audio.currentTime * 10000) / 10000;\n\t\t\t\t\tconst formattedTime = formatDecimal(currentTime, 3, 4);\n\n\t\t\t\t\tmin = (min) ? Math.min(min, currentTime) : currentTime;\n\t\t\t\t\tmax = (max) ? Math.max(max, currentTime) : currentTime;\n\t\t\t\t\tif (currentTime === 0) stem.audio.play();\n\t\t\t\t\tdebugString.push(`   stem ${index}: ${formattedTime} | ${stem.fileName} - ${activated} | ${stem.audio.buffered.end(0)} / ${stem.audio.duration}`);\n\t\t\t\t}\n\t\t\t});\n\t\t\tconst diff = formatDecimal(max - min, 1, 6);\n\t\t\tdebugString.push(`   max diff: ${diff}`);\n\t\t\tdebugOutput.innerHTML = debugString.join('<br>');\n\t\t}\n\t}, 100);\n\n\ttrack.stemsCount = stems.length;\n\treturn track;\n}\n\n\nexport default makeTrack;\n","\nclass PubSubEmitter {\n\tconstructor() {\n\t\t// create a new Map to hold all of the topics\n\t\tthis.listeners = new Map();\n\t}\n\n\tsubscribe(topic, callback) {\n\t\t// if the listener does not hae the topic yet, add it.\n\t\tif (!this.listeners.has(topic)) this.listeners.set(topic, []);\n\t\t// push the callback to the topic's array\n\t\tthis.listeners.get(topic).push(callback);\n\t}\n\n\tunsubscribe(topic, callback) {\n\t\tconst listeners = this.listeners.get(topic);\n\t\tlet index;\n\n\t\tif (listeners && listeners.length) {\n\t\t\t// find the index of the callback we're removing\n\t\t\tindex = listeners.reduce((i, listener, currentIndex) => {\n\t\t\t\t(typeof(listener) === 'function' && listener === callback) ?\n\t\t\t\t\ti = currentIndex :\n\t\t\t\t\ti;\n\t\t\t}, -1);\n\n\t\t\tif (index > -1) {\n\t\t\t\t// if we found a match, splice it out, and resupply the map with the spliced array\n\t\t\t\tlisteners.splice(index, 1);\n\t\t\t\tthis.listeners.set(topic, listeners);\n\t\t\t\treturn true; // return true if we removed something\n\t\t\t}\n\t\t}\n\t\treturn false; // return false if we didn't\n\t}\n\n\temit(topic, ...args) {\n\t\t// get the listeners subscribed to the topic\n\t\tconst listeners = this.listeners.get(topic);\n\n\t\tif (listeners && listeners.length) {\n\t\t\t// execute each callback with any supplied arguments\n\t\t\tlisteners.forEach((listener) => {\n\t\t\t\tlistener(...args);\n\t\t\t});\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n}\n\nconst publisher = new PubSubEmitter();\n\nexport default publisher;\n","// A small utility for getting DOM elements\nimport { query, queryOne } from '@artcommacode/q';\n\n// A component you can use to emit and subscribe to events.\n// Helpful to decouple UI stuff\nimport publisher from './components/publisher';\nimport makeTrack from './components/Track';\nimport makeButton from './components/Button';\n\n// first, just find the elements\nconst trackElements = query('.stem-track');\nconst everything = queryOne('.stem-buttons .play-all') || false;\nconst buttons = [];\nconst tracks = [];\n\nlet readyCount = 0;\n\nfunction readyHandler() {\n\treadyCount += 1;\n\tif (readyCount === tracks.length) {\n\t\tqueryOne('.stems-container').classList.add('ready');\n\t}\n}\n\n// add each composed track to an array\ntrackElements.map((track, index) => {\n\tconst newTrack = makeTrack(track, index, publisher, readyHandler);\n\ttracks.push(newTrack);\n});\n\nquery('.stem-buttons .stem-button').map((button, index) => {\n\tconst newButton = makeButton(button, index, publisher);\n\tbuttons.push(newButton);\n});\n\n/**\n * Event Listeners\n */\n\nif (everything) {\n\teverything.addEventListener('click', () => {\n\t\tpublisher.emit('allStemsActivated');\n\t});\n}\n\n// Use each track element as the source of a Stem object\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJub2RlX21vZHVsZXMvQGFydGNvbW1hY29kZS9xL2luZGV4LmpzIiwic3JjL2pzL2NvbXBvbmVudHMvQnV0dG9uLmpzIiwic3JjL2pzL2NvbXBvbmVudHMvU3RlbS5qcyIsInNyYy9qcy9jb21wb25lbnRzL1RyYWNrLmpzIiwic3JjL2pzL2NvbXBvbmVudHMvcHVibGlzaGVyLmpzIiwic3JjL2pzL3N0ZW1zLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQy9CQTs7Ozs7OztBQU9BLFNBQVMsVUFBVCxDQUFvQixFQUFwQixFQUF3QixXQUF4QixFQUFxQyxTQUFyQyxFQUFnRDtBQUMvQyxLQUFNLFNBQVMsRUFBZjtBQUNBLFFBQU8sT0FBUCxHQUFpQixFQUFqQjs7QUFFQSxRQUFPLE1BQVAsR0FBZ0IsU0FBUyxNQUFULEdBQWtCO0FBQ2pDLFNBQU8sT0FBUCxHQUFpQixJQUFqQjtBQUNBLFNBQU8sT0FBUCxDQUFlLFNBQWYsQ0FBeUIsR0FBekIsQ0FBNkIsU0FBN0I7QUFDQSxFQUhEOztBQUtBLFFBQU8sT0FBUCxHQUFpQixTQUFTLE9BQVQsR0FBbUI7QUFDbkMsU0FBTyxPQUFQLEdBQWlCLEtBQWpCO0FBQ0EsU0FBTyxPQUFQLENBQWUsU0FBZixDQUF5QixNQUF6QixDQUFnQyxTQUFoQztBQUNBLEVBSEQ7O0FBS0EsUUFBTyxhQUFQLEdBQXVCLFNBQVMsYUFBVCxHQUF5QjtBQUMvQyxNQUFJLE9BQU8sT0FBWCxFQUFvQjtBQUNuQixVQUFPLE9BQVA7QUFDQSxHQUZELE1BRU87QUFDTixVQUFPLE1BQVA7QUFDQTtBQUNELEVBTkQ7O0FBUUEsUUFBTyxRQUFQLEdBQWtCLFNBQVMsUUFBVCxHQUFvQjtBQUNyQyxNQUFJLENBQUMsT0FBTyxPQUFaLEVBQXFCLE9BQU8sTUFBUDtBQUNyQixTQUFPLE1BQVAsR0FBZ0IsSUFBaEI7QUFDQSxTQUFPLE9BQVAsQ0FBZSxTQUFmLENBQXlCLEdBQXpCLENBQTZCLFFBQTdCO0FBQ0EsRUFKRDs7QUFNQSxRQUFPLFVBQVAsR0FBb0IsU0FBUyxVQUFULEdBQXNCO0FBQ3pDLFNBQU8sTUFBUCxHQUFnQixLQUFoQjtBQUNBLFNBQU8sT0FBUCxDQUFlLFNBQWYsQ0FBeUIsTUFBekIsQ0FBZ0MsUUFBaEM7QUFDQSxFQUhEOztBQUtBLFFBQU8sWUFBUCxHQUFzQixTQUFTLFlBQVQsQ0FBc0IsVUFBdEIsRUFBa0M7QUFDdkQsU0FBTyxNQUFQLEdBQWdCLGNBQWMsQ0FBQyxPQUFPLE1BQXRDO0FBQ0EsTUFBSSxPQUFPLE1BQVAsS0FBa0IsSUFBdEIsRUFBNEI7QUFDM0IsVUFBTyxRQUFQO0FBQ0EsR0FGRCxNQUVPO0FBQ04sVUFBTyxVQUFQO0FBQ0E7QUFDRCxFQVBEOztBQVNBLFFBQU8sT0FBUCxDQUFlLGdCQUFmLENBQWdDLE9BQWhDLEVBQXlDLFlBQU07QUFDOUMsU0FBTyxZQUFQO0FBQ0EsTUFBTSxRQUFTLE9BQU8sTUFBUixHQUFrQixlQUFsQixHQUFvQyxpQkFBbEQ7QUFDQSxZQUFVLElBQVYsQ0FBZSxLQUFmLEVBQXNCLFdBQXRCO0FBQ0EsRUFKRDs7QUFNQSxXQUFVLFNBQVYsQ0FBb0Isb0JBQXBCLEVBQTBDLE9BQU8sT0FBakQ7O0FBRUEsV0FBVSxTQUFWLENBQW9CLGFBQXBCLEVBQW1DLFVBQUMsVUFBRCxFQUFhLFNBQWIsRUFBMkI7QUFDN0QsTUFBSSxlQUFlLFlBQVksQ0FBL0IsRUFBa0M7QUFDakMsVUFBTyxNQUFQO0FBQ0EsVUFBTyxRQUFQO0FBQ0EsR0FIRCxNQUdPO0FBQ04sVUFBTyxPQUFQO0FBQ0EsVUFBTyxVQUFQO0FBQ0E7QUFDRCxFQVJEOztBQVVBLFdBQVUsU0FBVixDQUFvQixZQUFwQixFQUFrQyxVQUFDLFdBQUQsRUFBaUI7QUFDbEQsTUFBSSxnQkFBZ0IsV0FBcEIsRUFBaUMsT0FBTyxRQUFQO0FBQ2pDLEVBRkQ7O0FBSUEsUUFBTyxNQUFQO0FBQ0E7O2tCQUVjLFU7Ozs7Ozs7OztBQzNFZjs7QUFFQTs7Ozs7O0FBTUEsU0FBUyxRQUFULENBQWtCLE9BQWxCLEVBQTJCO0FBQzFCLEtBQU0sT0FBTyxFQUFiO0FBQ0EsTUFBSyxLQUFMLEdBQWEsT0FBYjtBQUNBLE1BQUssTUFBTCxHQUFjLEtBQWQ7QUFDQSxLQUFNLE1BQU0sS0FBSyxLQUFMLENBQVcsWUFBWCxDQUF3QixLQUF4QixFQUErQixLQUEvQixDQUFxQyxHQUFyQyxDQUFaO0FBQ0EsTUFBSyxRQUFMLEdBQWdCLElBQUksS0FBSixDQUFVLENBQUMsQ0FBWCxFQUFjLENBQWQsQ0FBaEI7O0FBRUEsTUFBSyxJQUFMLEdBQVksU0FBUyxRQUFULEdBQW9CO0FBQy9CLE9BQUssTUFBTCxHQUFjLElBQWQ7QUFDQSxNQUFJO0FBQ0gsUUFBSyxLQUFMLENBQVcsSUFBWDtBQUNBLEdBRkQsQ0FFRSxPQUFPLENBQVAsRUFBVTtBQUNYO0FBQ0E7QUFDRCxFQVBEOztBQVNBLE1BQUssSUFBTCxHQUFZLFNBQVMsUUFBVCxHQUFvQjtBQUMvQixPQUFLLE1BQUwsR0FBYyxLQUFkO0FBQ0EsT0FBSyxLQUFMLENBQVcsS0FBWDtBQUNBLE9BQUssS0FBTCxDQUFXLFdBQVgsR0FBeUIsQ0FBekI7QUFDQSxFQUpEOztBQU1BLE1BQUssTUFBTCxHQUFjLFNBQVMsVUFBVCxHQUFzQjtBQUNuQyxPQUFLLE1BQUwsR0FBYyxJQUFkO0FBQ0EsT0FBSyxLQUFMLENBQVcsTUFBWCxHQUFvQixDQUFwQjtBQUNBLEVBSEQ7O0FBS0EsTUFBSyxJQUFMLEdBQVksU0FBUyxRQUFULEdBQW9CO0FBQy9CLE9BQUssTUFBTCxHQUFjLEtBQWQ7QUFDQSxPQUFLLEtBQUwsQ0FBVyxNQUFYLEdBQW9CLENBQXBCO0FBQ0EsRUFIRDs7QUFLQSxRQUFPLElBQVA7QUFDQTs7a0JBR2MsUTs7Ozs7Ozs7O0FDNUNmOztBQUNBOzs7Ozs7QUFFQTs7Ozs7O0FBTUEsU0FBUyxTQUFULENBQW1CLEVBQW5CLEVBQXVCLFVBQXZCLEVBQW1DLFNBQW5DLEVBQThDLGFBQTlDLEVBQTZEO0FBQzVELEtBQU0sUUFBUSxFQUFkO0FBQ0EsT0FBTSxPQUFOLEdBQWdCLEVBQWhCO0FBQ0EsS0FBTSxlQUFlLGNBQU0sT0FBTixFQUFlLEVBQWYsQ0FBckI7O0FBRUEsS0FBTSxRQUFRLEVBQWQ7O0FBRUE7O0FBRUEsVUFBUyxZQUFULEdBQXdCO0FBQ3ZCLE1BQU0sYUFBYSxNQUFNLE1BQU4sQ0FBYTtBQUFBLFVBQVEsS0FBSyxPQUFiO0FBQUEsR0FBYixFQUFtQyxNQUF0RDs7QUFFQSxNQUFJLGVBQWUsTUFBTSxNQUF6QixFQUFpQztBQUNoQyxTQUFNLEtBQU4sR0FBYyxJQUFkO0FBQ0E7QUFDQSxpQkFBYyxVQUFkO0FBQ0EsT0FBSSxDQUFDLE1BQU0sU0FBWCxFQUFzQjtBQUNyQixVQUFNLE9BQU4sQ0FBYyxTQUFkLENBQXdCLEdBQXhCLENBQTRCLE9BQTVCO0FBQ0EsSUFGRCxNQUVPO0FBQ04sVUFBTSxPQUFOLENBQWMsU0FBZCxDQUF3QixHQUF4QixDQUE0QixZQUE1QjtBQUNBO0FBQ0Q7QUFDRDs7QUFFRDtBQUNBO0FBQ0E7QUFDQSxjQUFhLEdBQWIsQ0FBaUIsVUFBQyxXQUFELEVBQWlCO0FBQ2pDLE1BQU0sT0FBTyxvQkFBUyxXQUFULENBQWI7QUFDQSxNQUFNLE1BQU0sWUFBWSxZQUFaLENBQXlCLEtBQXpCLEVBQWdDLEtBQWhDLENBQXNDLEdBQXRDLENBQVo7QUFDQSxPQUFLLFFBQUwsR0FBZ0IsSUFBSSxLQUFKLENBQVUsQ0FBQyxDQUFYLEVBQWMsQ0FBZCxDQUFoQjtBQUNBLFFBQU0sSUFBTixDQUFXLElBQVg7O0FBRUEsT0FBSyxLQUFMLENBQVcsSUFBWDs7QUFFQSxXQUFTLHFCQUFULEdBQWlDO0FBQ2hDO0FBQ0EsUUFBSyxPQUFMLEdBQWUsSUFBZjtBQUNBLFFBQUssS0FBTCxDQUFXLG1CQUFYLENBQStCLGdCQUEvQixFQUFpRCxxQkFBakQ7QUFDQTtBQUNBOztBQUVELE9BQUssS0FBTCxDQUFXLGdCQUFYLENBQTRCLGdCQUE1QixFQUE4QyxxQkFBOUM7O0FBRUEsT0FBSyxLQUFMLENBQVcsZ0JBQVgsQ0FBNEIsT0FBNUIsRUFBcUMsVUFBQyxDQUFELEVBQU87QUFDM0MsT0FBSSxFQUFFLE1BQUYsQ0FBUyxLQUFULENBQWUsSUFBZixLQUF3QixDQUF4QixJQUE2QixFQUFFLE1BQUYsQ0FBUyxLQUFULENBQWUsSUFBZixLQUF3QixDQUF6RCxFQUE0RDtBQUMzRCxZQUFRLElBQVIsQ0FBZ0IsS0FBSyxRQUFyQjtBQUNBLFNBQUssT0FBTCxHQUFlLElBQWY7QUFDQSxVQUFNLFNBQU4sR0FBa0IsSUFBbEI7QUFDQTtBQUNBO0FBQ0QsR0FQRDtBQVFBLEVBekJEOztBQTJCQTtBQUNBO0FBQ0E7OztBQUdBLFVBQVMsWUFBVCxHQUF3QjtBQUN2QixRQUFNLEdBQU4sQ0FBVSxVQUFDLElBQUQsRUFBTyxLQUFQLEVBQWlCO0FBQzFCLFFBQUssTUFBTDtBQUNBLGFBQVUsSUFBVixDQUFlLFlBQWYsRUFBNkIsS0FBN0I7QUFDQSxHQUhEO0FBSUE7O0FBR0QsS0FBTSxjQUFjLFNBQWQsV0FBYztBQUFBLFNBQU0sSUFBSSxPQUFKLENBQVksVUFBQyxPQUFELEVBQVUsTUFBVixFQUFxQjtBQUMxRCxTQUFNLEdBQU4sQ0FBVTtBQUFBLFdBQVEsS0FBSyxJQUFMLEVBQVI7QUFBQSxJQUFWO0FBQ0EsWUFBUyxTQUFULEdBQXFCO0FBQ3BCLFVBQU0sR0FBTixDQUFVO0FBQUEsWUFBUSxLQUFLLElBQUwsRUFBUjtBQUFBLEtBQVY7QUFDQSxRQUFNLFNBQVMsTUFBTSxNQUFOLENBQWEsVUFBQyxRQUFELEVBQVcsT0FBWCxFQUF1QjtBQUNsRCxZQUFPO0FBQ04sV0FBSyxLQUFLLEdBQUwsQ0FBUyxTQUFTLEdBQVQsSUFBZ0IsUUFBUSxLQUFSLENBQWMsV0FBdkMsRUFBb0QsUUFBUSxLQUFSLENBQWMsV0FBbEUsQ0FEQztBQUVOLFdBQUssS0FBSyxHQUFMLENBQVMsU0FBUyxHQUFULElBQWdCLFFBQVEsS0FBUixDQUFjLFdBQXZDLEVBQW9ELFFBQVEsS0FBUixDQUFjLFdBQWxFO0FBRkMsTUFBUDtBQUlBLEtBTGMsRUFLWixFQUFFLEtBQUssU0FBUCxFQUFrQixLQUFLLFNBQXZCLEVBTFksQ0FBZjtBQU1BLFFBQU0sT0FBTyxPQUFPLEdBQVAsR0FBYSxPQUFPLEdBQWpDO0FBQ0EsUUFBSSxPQUFPLEdBQVAsS0FBZSxDQUFuQixFQUFzQjtBQUNyQixhQUFRLEdBQVIsQ0FBWSwwQkFBWjtBQUNBLGdCQUFXLFNBQVgsRUFBc0IsSUFBdEI7QUFDQSxLQUhELE1BR08sSUFBSSxPQUFPLElBQVgsRUFBaUI7QUFDdkIsYUFBUSxHQUFSLDRCQUFxQyxJQUFyQztBQUNBLFdBQU0sR0FBTixDQUFVO0FBQUEsYUFBUSxLQUFLLElBQUwsRUFBUjtBQUFBLE1BQVY7QUFDQSxnQkFBVyxZQUFNO0FBQ2hCO0FBQ0E7QUFDQSxNQUhELEVBR0csR0FISDtBQUlBLEtBUE0sTUFPQTtBQUNOLGFBQVEsR0FBUixZQUFxQixJQUFyQjtBQUNBLFdBQU0sR0FBTixDQUFVO0FBQUEsYUFBUSxLQUFLLElBQUwsRUFBUjtBQUFBLE1BQVY7QUFDQSxnQkFBVyxTQUFYLEVBQXNCLElBQXRCO0FBQ0E7QUFDRDtBQUNELGNBQVcsU0FBWCxFQUFzQixJQUF0QjtBQUNBLEdBNUJ5QixDQUFOO0FBQUEsRUFBcEI7O0FBOEJBLFVBQVMsSUFBVCxHQUFnQjtBQUNmLFFBQU0sTUFBTixHQUFlLElBQWY7QUFDQSxRQUFNLE9BQU4sQ0FBYyxTQUFkLENBQXdCLEdBQXhCLENBQTRCLFNBQTVCO0FBQ0E7QUFDQTtBQUNBLE1BQUksQ0FBQyxNQUFNLEtBQVgsRUFBa0IsT0FBTyxLQUFQO0FBQ2xCO0FBQ0EsZ0JBQWMsSUFBZCxDQUFtQixZQUFNO0FBQ3hCLFNBQU0sT0FBTixDQUFjLFNBQWQsQ0FBd0IsTUFBeEIsQ0FBK0IsU0FBL0I7QUFDQSxTQUFNLE9BQU4sQ0FBYyxTQUFkLENBQXdCLEdBQXhCLENBQTRCLFNBQTVCO0FBQ0EsYUFBVSxJQUFWLENBQWUsYUFBZixFQUE4QixVQUE5QixFQUEwQyxNQUFNLE1BQWhEO0FBQ0EsR0FKRDtBQUtBLFNBQU8sSUFBUDtBQUNBOztBQUVELFVBQVMsSUFBVCxHQUFnQjtBQUNmLFFBQU0sR0FBTixDQUFVO0FBQUEsVUFBUSxLQUFLLElBQUwsRUFBUjtBQUFBLEdBQVY7QUFDQSxRQUFNLE1BQU4sR0FBZSxLQUFmO0FBQ0EsUUFBTSxPQUFOLENBQWMsU0FBZCxDQUF3QixNQUF4QixDQUErQixTQUEvQjtBQUNBOztBQUVEOzs7O0FBSUEsT0FBTSxPQUFOLENBQWMsZ0JBQWQsQ0FBK0IsT0FBL0IsRUFBd0MsSUFBeEM7O0FBRUEsV0FBVSxTQUFWLENBQW9CLGFBQXBCLEVBQW1DLFVBQUMsUUFBRCxFQUFjO0FBQ2hELE1BQUksYUFBYSxVQUFqQixFQUE2QjtBQUM1QixPQUFJLENBQUMsTUFBTSxNQUFYLEVBQW1CO0FBQ25CLEdBRkQsTUFFTztBQUNOO0FBQ0E7QUFDRCxFQU5EOztBQVFBLFdBQVUsU0FBVixDQUFvQixlQUFwQixFQUFxQyxVQUFDLFNBQUQsRUFBZTtBQUNuRCxNQUFJLE1BQU0sTUFBVixFQUFrQixNQUFNLFNBQU4sRUFBaUIsTUFBakI7QUFDbEIsRUFGRDtBQUdBLFdBQVUsU0FBVixDQUFvQixpQkFBcEIsRUFBdUMsVUFBQyxTQUFELEVBQWU7QUFDckQsVUFBUSxHQUFSLENBQVksU0FBWixFQUF1QixNQUFNLE1BQTdCO0FBQ0EsTUFBSSxNQUFNLE1BQVYsRUFBa0IsTUFBTSxTQUFOLEVBQWlCLElBQWpCO0FBQ2xCLEVBSEQ7O0FBS0EsV0FBVSxTQUFWLENBQW9CLG1CQUFwQixFQUF5QyxZQUF6Qzs7QUFFQTs7OztBQUlBLEtBQU0sY0FBYyxpQkFBUyxlQUFULENBQXBCOztBQUVBLFdBQVUsU0FBVixDQUFvQixhQUFwQixFQUFtQyxZQUFNO0FBQ3hDLGNBQVksU0FBWixHQUF3QixFQUF4QjtBQUNBLEVBRkQ7O0FBSUEsVUFBUyxHQUFULENBQWEsS0FBYixFQUFvRTtBQUFBLE1BQWhELFNBQWdELHVFQUFwQyxDQUFvQztBQUFBLE1BQWpDLElBQWlDLHVFQUExQixHQUEwQjtBQUFBLE1BQXJCLFNBQXFCLHVFQUFULE9BQVM7O0FBQ25FLE1BQUksU0FBUyxNQUFNLFFBQU4sRUFBYjtBQUNBLE1BQU0sT0FBTyxZQUFZLE1BQU0sTUFBL0I7QUFDQSxPQUFLLElBQUksSUFBSSxDQUFiLEVBQWdCLElBQUksSUFBcEIsRUFBMEIsS0FBSyxDQUEvQixFQUFrQztBQUNqQyxPQUFJLGNBQWMsT0FBbEIsRUFBMkI7QUFDMUIsY0FBVSxJQUFWO0FBQ0EsSUFGRCxNQUVPO0FBQ04sYUFBUyxPQUFPLE1BQWhCO0FBQ0E7QUFDRDtBQUNELFNBQU8sTUFBUDtBQUNBOztBQUVELFVBQVMsYUFBVCxDQUF1QixLQUF2QixFQUE4QixPQUE5QixFQUF1QyxPQUF2QyxFQUFnRDtBQUMvQyxNQUFNLE1BQU0sTUFBTSxRQUFOLEdBQWlCLEtBQWpCLENBQXVCLEdBQXZCLENBQVo7QUFDQSxNQUFJLElBQUksTUFBSixLQUFlLENBQW5CLEVBQXNCLElBQUksSUFBSixDQUFTLEdBQVQ7QUFDdEIsTUFBTSxRQUFRLElBQUksSUFBSSxDQUFKLENBQUosRUFBWSxPQUFaLEVBQXFCLEdBQXJCLEVBQTBCLE1BQTFCLENBQWQ7QUFDQSxNQUFNLE1BQU0sSUFBSSxJQUFJLENBQUosQ0FBSixFQUFZLE9BQVosRUFBcUIsR0FBckIsRUFBMEIsT0FBMUIsRUFBbUMsTUFBbkMsQ0FBMEMsQ0FBMUMsRUFBNkMsT0FBN0MsQ0FBWjtBQUNBLFNBQVUsS0FBVixTQUFtQixHQUFuQjtBQUNBOztBQUVELGFBQVksWUFBTTtBQUNqQixNQUFJLE1BQU0sTUFBVixFQUFrQjtBQUNqQixPQUFNLGNBQWMsQ0FBQyxTQUFELENBQXBCO0FBQ0EsT0FBSSxZQUFKO0FBQ0EsT0FBSSxZQUFKO0FBQ0EsU0FBTSxHQUFOLENBQVUsVUFBQyxJQUFELEVBQU8sS0FBUCxFQUFpQjtBQUMxQixRQUFJLEtBQUssS0FBVCxFQUFnQjtBQUNmLFNBQU0sWUFBYSxLQUFLLE1BQU4sR0FBZ0IsV0FBaEIsR0FBOEIsYUFBaEQ7QUFDQSxTQUFNLGNBQWMsS0FBSyxLQUFMLENBQVcsS0FBSyxLQUFMLENBQVcsV0FBWCxHQUF5QixLQUFwQyxJQUE2QyxLQUFqRTtBQUNBLFNBQU0sZ0JBQWdCLGNBQWMsV0FBZCxFQUEyQixDQUEzQixFQUE4QixDQUE5QixDQUF0Qjs7QUFFQSxXQUFPLEdBQUQsR0FBUSxLQUFLLEdBQUwsQ0FBUyxHQUFULEVBQWMsV0FBZCxDQUFSLEdBQXFDLFdBQTNDO0FBQ0EsV0FBTyxHQUFELEdBQVEsS0FBSyxHQUFMLENBQVMsR0FBVCxFQUFjLFdBQWQsQ0FBUixHQUFxQyxXQUEzQztBQUNBLFNBQUksZ0JBQWdCLENBQXBCLEVBQXVCLEtBQUssS0FBTCxDQUFXLElBQVg7QUFDdkIsaUJBQVksSUFBWixjQUE0QixLQUE1QixVQUFzQyxhQUF0QyxXQUF5RCxLQUFLLFFBQTlELFdBQTRFLFNBQTVFLFdBQTJGLEtBQUssS0FBTCxDQUFXLFFBQVgsQ0FBb0IsR0FBcEIsQ0FBd0IsQ0FBeEIsQ0FBM0YsV0FBMkgsS0FBSyxLQUFMLENBQVcsUUFBdEk7QUFDQTtBQUNELElBWEQ7QUFZQSxPQUFNLE9BQU8sY0FBYyxNQUFNLEdBQXBCLEVBQXlCLENBQXpCLEVBQTRCLENBQTVCLENBQWI7QUFDQSxlQUFZLElBQVosbUJBQWlDLElBQWpDO0FBQ0EsZUFBWSxTQUFaLEdBQXdCLFlBQVksSUFBWixDQUFpQixNQUFqQixDQUF4QjtBQUNBO0FBQ0QsRUFyQkQsRUFxQkcsR0FyQkg7O0FBdUJBLE9BQU0sVUFBTixHQUFtQixNQUFNLE1BQXpCO0FBQ0EsUUFBTyxLQUFQO0FBQ0E7O2tCQUdjLFM7Ozs7Ozs7Ozs7Ozs7SUNqTlQsYTtBQUNMLDBCQUFjO0FBQUE7O0FBQ2I7QUFDQSxPQUFLLFNBQUwsR0FBaUIsSUFBSSxHQUFKLEVBQWpCO0FBQ0E7Ozs7NEJBRVMsSyxFQUFPLFEsRUFBVTtBQUMxQjtBQUNBLE9BQUksQ0FBQyxLQUFLLFNBQUwsQ0FBZSxHQUFmLENBQW1CLEtBQW5CLENBQUwsRUFBZ0MsS0FBSyxTQUFMLENBQWUsR0FBZixDQUFtQixLQUFuQixFQUEwQixFQUExQjtBQUNoQztBQUNBLFFBQUssU0FBTCxDQUFlLEdBQWYsQ0FBbUIsS0FBbkIsRUFBMEIsSUFBMUIsQ0FBK0IsUUFBL0I7QUFDQTs7OzhCQUVXLEssRUFBTyxRLEVBQVU7QUFDNUIsT0FBTSxZQUFZLEtBQUssU0FBTCxDQUFlLEdBQWYsQ0FBbUIsS0FBbkIsQ0FBbEI7QUFDQSxPQUFJLGNBQUo7O0FBRUEsT0FBSSxhQUFhLFVBQVUsTUFBM0IsRUFBbUM7QUFDbEM7QUFDQSxZQUFRLFVBQVUsTUFBVixDQUFpQixVQUFDLENBQUQsRUFBSSxRQUFKLEVBQWMsWUFBZCxFQUErQjtBQUN0RCxZQUFPLFFBQVAsS0FBcUIsVUFBckIsSUFBbUMsYUFBYSxRQUFqRCxHQUNDLElBQUksWUFETCxHQUVDLENBRkQ7QUFHQSxLQUpPLEVBSUwsQ0FBQyxDQUpJLENBQVI7O0FBTUEsUUFBSSxRQUFRLENBQUMsQ0FBYixFQUFnQjtBQUNmO0FBQ0EsZUFBVSxNQUFWLENBQWlCLEtBQWpCLEVBQXdCLENBQXhCO0FBQ0EsVUFBSyxTQUFMLENBQWUsR0FBZixDQUFtQixLQUFuQixFQUEwQixTQUExQjtBQUNBLFlBQU8sSUFBUCxDQUplLENBSUY7QUFDYjtBQUNEO0FBQ0QsVUFBTyxLQUFQLENBbkI0QixDQW1CZDtBQUNkOzs7dUJBRUksSyxFQUFnQjtBQUFBLHFDQUFOLElBQU07QUFBTixRQUFNO0FBQUE7O0FBQ3BCO0FBQ0EsT0FBTSxZQUFZLEtBQUssU0FBTCxDQUFlLEdBQWYsQ0FBbUIsS0FBbkIsQ0FBbEI7O0FBRUEsT0FBSSxhQUFhLFVBQVUsTUFBM0IsRUFBbUM7QUFDbEM7QUFDQSxjQUFVLE9BQVYsQ0FBa0IsVUFBQyxRQUFELEVBQWM7QUFDL0IsK0JBQVksSUFBWjtBQUNBLEtBRkQ7QUFHQSxXQUFPLElBQVA7QUFDQTtBQUNELFVBQU8sS0FBUDtBQUNBOzs7Ozs7QUFHRixJQUFNLFlBQVksSUFBSSxhQUFKLEVBQWxCOztrQkFFZSxTOzs7OztBQ3BEZjs7QUFJQTs7OztBQUNBOzs7O0FBQ0E7Ozs7OztBQUVBO0FBVEE7QUFVQSxJQUFNLGdCQUFnQixjQUFNLGFBQU4sQ0FBdEI7O0FBUEE7QUFDQTs7QUFPQSxJQUFNLGFBQWEsaUJBQVMseUJBQVQsS0FBdUMsS0FBMUQ7QUFDQSxJQUFNLFVBQVUsRUFBaEI7QUFDQSxJQUFNLFNBQVMsRUFBZjs7QUFFQSxJQUFJLGFBQWEsQ0FBakI7O0FBRUEsU0FBUyxZQUFULEdBQXdCO0FBQ3ZCLGVBQWMsQ0FBZDtBQUNBLEtBQUksZUFBZSxPQUFPLE1BQTFCLEVBQWtDO0FBQ2pDLG1CQUFTLGtCQUFULEVBQTZCLFNBQTdCLENBQXVDLEdBQXZDLENBQTJDLE9BQTNDO0FBQ0E7QUFDRDs7QUFFRDtBQUNBLGNBQWMsR0FBZCxDQUFrQixVQUFDLEtBQUQsRUFBUSxLQUFSLEVBQWtCO0FBQ25DLEtBQU0sV0FBVyxxQkFBVSxLQUFWLEVBQWlCLEtBQWpCLHVCQUFtQyxZQUFuQyxDQUFqQjtBQUNBLFFBQU8sSUFBUCxDQUFZLFFBQVo7QUFDQSxDQUhEOztBQUtBLGNBQU0sNEJBQU4sRUFBb0MsR0FBcEMsQ0FBd0MsVUFBQyxNQUFELEVBQVMsS0FBVCxFQUFtQjtBQUMxRCxLQUFNLFlBQVksc0JBQVcsTUFBWCxFQUFtQixLQUFuQixzQkFBbEI7QUFDQSxTQUFRLElBQVIsQ0FBYSxTQUFiO0FBQ0EsQ0FIRDs7QUFLQTs7OztBQUlBLElBQUksVUFBSixFQUFnQjtBQUNmLFlBQVcsZ0JBQVgsQ0FBNEIsT0FBNUIsRUFBcUMsWUFBTTtBQUMxQyxzQkFBVSxJQUFWLENBQWUsbUJBQWY7QUFDQSxFQUZEO0FBR0E7O0FBRUQiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG5cbmZ1bmN0aW9uIF90b0NvbnN1bWFibGVBcnJheShhcnIpIHsgaWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgeyBmb3IgKHZhciBpID0gMCwgYXJyMiA9IEFycmF5KGFyci5sZW5ndGgpOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7IGFycjJbaV0gPSBhcnJbaV07IH0gcmV0dXJuIGFycjI7IH0gZWxzZSB7IHJldHVybiBBcnJheS5mcm9tKGFycik7IH0gfVxuXG52YXIgdG9BcnJheSA9IGZ1bmN0aW9uIHRvQXJyYXkobGlzdCkge1xuICByZXR1cm4gW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShsaXN0KSk7XG59O1xuXG52YXIgZmlyc3QgPSBmdW5jdGlvbiBmaXJzdCh4cykge1xuICByZXR1cm4geHNbMF07XG59O1xuXG52YXIgZWxlbUVycm9yID0gZnVuY3Rpb24gZWxlbUVycm9yKGUpIHtcbiAgdGhyb3cgbmV3IEVycm9yKFwiXFxcIlwiICsgU3RyaW5nKGUpICsgXCJcXFwiIGRvZXMndCBleGlzdCBpbiB0aGUgZG9jdW1lbnRcIik7XG59O1xuXG52YXIgZ2V0Um9vdCA9IGZ1bmN0aW9uIGdldFJvb3QoZSkge1xuICByZXR1cm4gIWUgPyBkb2N1bWVudCA6IGRvY3VtZW50ICYmIGRvY3VtZW50LmJvZHkgJiYgZG9jdW1lbnQuYm9keS5jb250YWlucyhlKSA/IGUgOiBlbGVtRXJyb3IoZSk7XG59O1xuXG52YXIgcXVlcnkgPSBleHBvcnRzLnF1ZXJ5ID0gZnVuY3Rpb24gcXVlcnkocSwgZSkge1xuICB2YXIgcm9vdCA9IGdldFJvb3QoZSk7XG4gIHJldHVybiByb290ID8gdG9BcnJheShyb290LnF1ZXJ5U2VsZWN0b3JBbGwocSkpIDogW107XG59O1xuXG52YXIgcXVlcnlPbmUgPSBleHBvcnRzLnF1ZXJ5T25lID0gZnVuY3Rpb24gcXVlcnlPbmUocSwgZSkge1xuICByZXR1cm4gZmlyc3QocXVlcnkocSwgZSkpO1xufTtcbiIsIlxuLyoqXG4gKiBSZWNlaXZlcyBhIERPTSBlbGVtZW50LlxuICogUmV0dXJucyBhbiBvYmplY3Qgd2l0aCBlbmFibGUsIGFjdGl2YXRlLCBhbmQgZGVhY3RpdmF0ZSBtZXRob2RzXG4gKiBAcGFyYW0gIHtET00gZWxlbWVudH0gZWxlbWVudFxuICogQHJldHVybiB7U2hhcGV9XG4gKi9cblxuZnVuY3Rpb24gbWFrZUJ1dHRvbihlbCwgYnV0dG9uSW5kZXgsIHB1Ymxpc2hlcikge1xuXHRjb25zdCBidXR0b24gPSB7fTtcblx0YnV0dG9uLmVsZW1lbnQgPSBlbDtcblxuXHRidXR0b24uZW5hYmxlID0gZnVuY3Rpb24gZW5hYmxlKCkge1xuXHRcdGJ1dHRvbi5lbmFibGVkID0gdHJ1ZTtcblx0XHRidXR0b24uZWxlbWVudC5jbGFzc0xpc3QuYWRkKCdlbmFibGVkJyk7XG5cdH07XG5cblx0YnV0dG9uLmRpc2FibGUgPSBmdW5jdGlvbiBkaXNhYmxlKCkge1xuXHRcdGJ1dHRvbi5lbmFibGVkID0gZmFsc2U7XG5cdFx0YnV0dG9uLmVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnZW5hYmxlZCcpO1xuXHR9O1xuXG5cdGJ1dHRvbi50b2dnbGVFbmFibGVkID0gZnVuY3Rpb24gdG9nZ2xlRW5hYmxlZCgpIHtcblx0XHRpZiAoYnV0dG9uLmVuYWJsZWQpIHtcblx0XHRcdGJ1dHRvbi5kaXNhYmxlKCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGJ1dHRvbi5lbmFibGUoKTtcblx0XHR9XG5cdH07XG5cblx0YnV0dG9uLmFjdGl2YXRlID0gZnVuY3Rpb24gYWN0aXZhdGUoKSB7XG5cdFx0aWYgKCFidXR0b24uZW5hYmxlZCkgYnV0dG9uLmVuYWJsZSgpO1xuXHRcdGJ1dHRvbi5hY3RpdmUgPSB0cnVlO1xuXHRcdGJ1dHRvbi5lbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpO1xuXHR9O1xuXG5cdGJ1dHRvbi5kZWFjdGl2YXRlID0gZnVuY3Rpb24gZGVhY3RpdmF0ZSgpIHtcblx0XHRidXR0b24uYWN0aXZlID0gZmFsc2U7XG5cdFx0YnV0dG9uLmVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XG5cdH07XG5cblx0YnV0dG9uLnRvZ2dsZUFjdGl2ZSA9IGZ1bmN0aW9uIHRvZ2dsZUFjdGl2ZShpbnB1dFN0YXRlKSB7XG5cdFx0YnV0dG9uLmFjdGl2ZSA9IGlucHV0U3RhdGUgfHwgIWJ1dHRvbi5hY3RpdmU7XG5cdFx0aWYgKGJ1dHRvbi5hY3RpdmUgPT09IHRydWUpIHtcblx0XHRcdGJ1dHRvbi5hY3RpdmF0ZSgpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRidXR0b24uZGVhY3RpdmF0ZSgpO1xuXHRcdH1cblx0fTtcblxuXHRidXR0b24uZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcblx0XHRidXR0b24udG9nZ2xlQWN0aXZlKCk7XG5cdFx0Y29uc3QgZXZlbnQgPSAoYnV0dG9uLmFjdGl2ZSkgPyAnc3RlbUFjdGl2YXRlZCcgOiAnc3RlbURlYWN0aXZhdGVkJztcblx0XHRwdWJsaXNoZXIuZW1pdChldmVudCwgYnV0dG9uSW5kZXgpO1xuXHR9KTtcblxuXHRwdWJsaXNoZXIuc3Vic2NyaWJlKCdhbGxCdXR0b25zRGlzYWJsZWQnLCBidXR0b24uZGlzYWJsZSk7XG5cblx0cHVibGlzaGVyLnN1YnNjcmliZSgndHJhY2tQbGF5ZWQnLCAodHJhY2tJbmRleCwgc3RlbUNvdW50KSA9PiB7XG5cdFx0aWYgKGJ1dHRvbkluZGV4IDw9IHN0ZW1Db3VudCAtIDEpIHtcblx0XHRcdGJ1dHRvbi5lbmFibGUoKTtcblx0XHRcdGJ1dHRvbi5hY3RpdmF0ZSgpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRidXR0b24uZGlzYWJsZSgpO1xuXHRcdFx0YnV0dG9uLmRlYWN0aXZhdGUoKTtcblx0XHR9XG5cdH0pXG5cblx0cHVibGlzaGVyLnN1YnNjcmliZSgnc3RlbVBsYXllZCcsIChhY3RpdmVJbmRleCkgPT4ge1xuXHRcdGlmIChhY3RpdmVJbmRleCA9PT0gYnV0dG9uSW5kZXgpIGJ1dHRvbi5hY3RpdmF0ZSgpO1xuXHR9KTtcblxuXHRyZXR1cm4gYnV0dG9uO1xufVxuXG5leHBvcnQgZGVmYXVsdCBtYWtlQnV0dG9uO1xuIiwiaW1wb3J0IHsgcXVlcnksIHF1ZXJ5T25lIH0gZnJvbSAnQGFydGNvbW1hY29kZS9xJztcblxuLyoqXG4gKiBSZWNlaXZlcyBhIERPTSBlbGVtZW50IHdpdGggbGlua3MgdG8gYXVkaW8gZmlsZXMgdG8gYmUgcGxheWVkIGluIHRhbmRlbSBhcyBzdGVtcy5cbiAqIFJldHVybnMgYW4gb2JqZWN0IHdpdGggcGxheS9wYXVzZS9tdXRlIG1ldGhvZHNcbiAqIEBwYXJhbSAge0RPTSBlbGVtZW50fSBlbGVtZW50XG4gKiBAcmV0dXJuIHtTdGVtfVxuICovXG5mdW5jdGlvbiBtYWtlU3RlbShlbGVtZW50KSB7XG5cdGNvbnN0IHN0ZW0gPSB7fTtcblx0c3RlbS5hdWRpbyA9IGVsZW1lbnQ7XG5cdHN0ZW0uYWN0aXZlID0gZmFsc2U7XG5cdGNvbnN0IHVybCA9IHN0ZW0uYXVkaW8uZ2V0QXR0cmlidXRlKCdzcmMnKS5zcGxpdCgnLycpO1xuXHRzdGVtLmZpbGVOYW1lID0gdXJsLnNsaWNlKC0xKVswXTtcblxuXHRzdGVtLnBsYXkgPSBmdW5jdGlvbiBwbGF5U3RlbSgpIHtcblx0XHRzdGVtLmFjdGl2ZSA9IHRydWU7XG5cdFx0dHJ5IHtcblx0XHRcdHN0ZW0uYXVkaW8ucGxheSgpO1xuXHRcdH0gY2F0Y2ggKGUpIHtcblx0XHRcdC8vIGRvIG5vdGhpbmdcblx0XHR9XG5cdH07XG5cblx0c3RlbS5zdG9wID0gZnVuY3Rpb24gc3RvcFN0ZW0oKSB7XG5cdFx0c3RlbS5hY3RpdmUgPSBmYWxzZTtcblx0XHRzdGVtLmF1ZGlvLnBhdXNlKCk7XG5cdFx0c3RlbS5hdWRpby5jdXJyZW50VGltZSA9IDA7XG5cdH07XG5cblx0c3RlbS51bm11dGUgPSBmdW5jdGlvbiB1bm11dGVTdGVtKCkge1xuXHRcdHN0ZW0uYWN0aXZlID0gdHJ1ZTtcblx0XHRzdGVtLmF1ZGlvLnZvbHVtZSA9IDE7XG5cdH07XG5cblx0c3RlbS5tdXRlID0gZnVuY3Rpb24gbXV0ZVN0ZW0oKSB7XG5cdFx0c3RlbS5hY3RpdmUgPSBmYWxzZTtcblx0XHRzdGVtLmF1ZGlvLnZvbHVtZSA9IDA7XG5cdH07XG5cblx0cmV0dXJuIHN0ZW07XG59XG5cblxuZXhwb3J0IGRlZmF1bHQgbWFrZVN0ZW07XG4iLCJpbXBvcnQgeyBxdWVyeSwgcXVlcnlPbmUgfSBmcm9tICdAYXJ0Y29tbWFjb2RlL3EnO1xuaW1wb3J0IG1ha2VTdGVtIGZyb20gJy4vU3RlbSc7XG5cbi8qKlxuICogUmVjZWl2ZXMgYSBET00gZWxlbWVudCB3aXRoIGxpbmtzIHRvIGF1ZGlvIGZpbGVzIHRvIGJlIHBsYXllZCBpbiB0YW5kZW0gYXMgc3RlbXMuXG4gKiBSZXR1cm5zIGFuIG9iamVjdCB3aXRoIHBsYXkvcGF1c2UvbXV0ZSBtZXRob2RzXG4gKiBAcGFyYW0gIHtET00gZWxlbWVudH0gZWxlbWVudFxuICogQHJldHVybiB7U3RlbX1cbiAqL1xuZnVuY3Rpb24gbWFrZVRyYWNrKGVsLCB0cmFja0luZGV4LCBwdWJsaXNoZXIsIHJlYWR5Q2FsbGJhY2spIHtcblx0Y29uc3QgdHJhY2sgPSB7fTtcblx0dHJhY2suZWxlbWVudCA9IGVsO1xuXHRjb25zdCBzdGVtRWxlbWVudHMgPSBxdWVyeSgnYXVkaW8nLCBlbCk7XG5cblx0Y29uc3Qgc3RlbXMgPSBbXTtcblxuXHQvLyBTZWUgaWYgYWxsIG9mIHRoZSB0cmFja3MgYXJlIHJlYWR5XG5cblx0ZnVuY3Rpb24gY2hlY2tJZlJlYWR5KCkge1xuXHRcdGNvbnN0IHJlYWR5Q291bnQgPSBzdGVtcy5maWx0ZXIoc3RlbSA9PiBzdGVtLmlzUmVhZHkpLmxlbmd0aDtcblxuXHRcdGlmIChyZWFkeUNvdW50ID09PSBzdGVtcy5sZW5ndGgpIHtcblx0XHRcdHRyYWNrLnJlYWR5ID0gdHJ1ZTtcblx0XHRcdC8vIHJlcG9ydHMgYmFjayB0byB0aGUgbWFpbiBzY3JpcHQsIHNvIGl0IGNhbiBjb3VudCBhbGwgb2YgdGhlIGxvYWRlZCB0cmFja3Ncblx0XHRcdHJlYWR5Q2FsbGJhY2sodHJhY2tJbmRleCk7XG5cdFx0XHRpZiAoIXRyYWNrLmhhc0Vycm9ycykge1xuXHRcdFx0XHR0cmFjay5lbGVtZW50LmNsYXNzTGlzdC5hZGQoJ3JlYWR5Jyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0cmFjay5lbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2hhcy1lcnJvcnMnKTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHQvLyBhZGQgZWFjaCBlbGVtZW50IHRvIHRoZSB0cmFja3MgYXJyYXkuXG5cdC8vIFdoZW4gaXQncyBsb2FkZWQsIHJlcG9ydCBpdC5cblx0Ly8gSWYgdGhlcmUgaXMgYSBuZXR3b3JrIGVycm9yLCBmbGFnIHRoZSB0cmFja1xuXHRzdGVtRWxlbWVudHMubWFwKChzdGVtRWxlbWVudCkgPT4ge1xuXHRcdGNvbnN0IHN0ZW0gPSBtYWtlU3RlbShzdGVtRWxlbWVudCk7XG5cdFx0Y29uc3QgdXJsID0gc3RlbUVsZW1lbnQuZ2V0QXR0cmlidXRlKCdzcmMnKS5zcGxpdCgnLycpO1xuXHRcdHN0ZW0uZmlsZU5hbWUgPSB1cmwuc2xpY2UoLTEpWzBdO1xuXHRcdHN0ZW1zLnB1c2goc3RlbSk7XG5cblx0XHRzdGVtLmF1ZGlvLmxvYWQoKTtcblxuXHRcdGZ1bmN0aW9uIGNhblBsYXlUaHJvdWdoSGFuZGxlcigpIHtcblx0XHRcdC8vIGNvbnNvbGUubG9nKGAke3RyYWNrSW5kZXh9IC0gJHtzdGVtLmZpbGVOYW1lfSBpcyByZWFkeWApXG5cdFx0XHRzdGVtLmlzUmVhZHkgPSB0cnVlO1xuXHRcdFx0c3RlbS5hdWRpby5yZW1vdmVFdmVudExpc3RlbmVyKCdjYW5wbGF5dGhyb3VnaCcsIGNhblBsYXlUaHJvdWdoSGFuZGxlcik7XG5cdFx0XHRjaGVja0lmUmVhZHkoKTtcblx0XHR9XG5cblx0XHRzdGVtLmF1ZGlvLmFkZEV2ZW50TGlzdGVuZXIoJ2NhbnBsYXl0aHJvdWdoJywgY2FuUGxheVRocm91Z2hIYW5kbGVyKTtcblxuXHRcdHN0ZW0uYXVkaW8uYWRkRXZlbnRMaXN0ZW5lcignZXJyb3InLCAoZSkgPT4ge1xuXHRcdFx0aWYgKGUudGFyZ2V0LmVycm9yLmNvZGUgPT09IDMgfHwgZS50YXJnZXQuZXJyb3IuY29kZSA9PT0gNCkge1xuXHRcdFx0XHRjb25zb2xlLndhcm4oYCR7c3RlbS5maWxlTmFtZX0gY291bGQgbm90IGJlIGxvYWRlZGApO1xuXHRcdFx0XHRzdGVtLmlzUmVhZHkgPSB0cnVlO1xuXHRcdFx0XHR0cmFjay5oYXNFcnJvcnMgPSB0cnVlO1xuXHRcdFx0XHRjaGVja0lmUmVhZHkoKTtcblx0XHRcdH1cblx0XHR9KTtcblx0fSk7XG5cblx0Ly8gZnVuY3Rpb25zIHRoYXQgd2UgYXR0YWNoIHRvIHRoZSAndHJhY2snIG9iamVjdCBhcmUgcHVibGljICZcblx0Ly8gdXNhYmxlIGZyb20gdGhlIG91dHNpZGUuXG5cdC8vIEV2ZXJ5dGhpbmcgZWxzZSBpcyBwcml2YXRlLlxuXG5cblx0ZnVuY3Rpb24gcGxheUFsbFN0ZW1zKCkge1xuXHRcdHN0ZW1zLm1hcCgoc3RlbSwgaW5kZXgpID0+IHtcblx0XHRcdHN0ZW0udW5tdXRlKCk7XG5cdFx0XHRwdWJsaXNoZXIuZW1pdCgnc3RlbVBsYXllZCcsIGluZGV4KTtcblx0XHR9KTtcblx0fVxuXG5cblx0Y29uc3Qgc3RhcnRTeW5jZWQgPSAoKSA9PiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG5cdFx0c3RlbXMubWFwKHN0ZW0gPT4gc3RlbS5tdXRlKCkpO1xuXHRcdGZ1bmN0aW9uIGNoZWNrU3luYygpIHtcblx0XHRcdHN0ZW1zLm1hcChzdGVtID0+IHN0ZW0ucGxheSgpKTtcblx0XHRcdGNvbnN0IG1pbk1heCA9IHN0ZW1zLnJlZHVjZSgocHJldmlvdXMsIGN1cnJlbnQpID0+IHtcblx0XHRcdFx0cmV0dXJuIHtcblx0XHRcdFx0XHRtaW46IE1hdGgubWluKHByZXZpb3VzLm1pbiB8fCBjdXJyZW50LmF1ZGlvLmN1cnJlbnRUaW1lLCBjdXJyZW50LmF1ZGlvLmN1cnJlbnRUaW1lKSxcblx0XHRcdFx0XHRtYXg6IE1hdGgubWF4KHByZXZpb3VzLm1heCB8fCBjdXJyZW50LmF1ZGlvLmN1cnJlbnRUaW1lLCBjdXJyZW50LmF1ZGlvLmN1cnJlbnRUaW1lKSxcblx0XHRcdFx0fTtcblx0XHRcdH0sIHsgbWluOiB1bmRlZmluZWQsIG1heDogdW5kZWZpbmVkIH0pO1xuXHRcdFx0Y29uc3QgZGlmZiA9IG1pbk1heC5tYXggLSBtaW5NYXgubWluO1xuXHRcdFx0aWYgKG1pbk1heC5tYXggPT09IDApIHtcblx0XHRcdFx0Y29uc29sZS5sb2coJ05vdCByZWFkeS4uIHRyeWluZyBhZ2FpbicpO1xuXHRcdFx0XHRzZXRUaW1lb3V0KGNoZWNrU3luYywgMTAwMCk7XG5cdFx0XHR9IGVsc2UgaWYgKGRpZmYgPCAwLjA1KSB7XG5cdFx0XHRcdGNvbnNvbGUubG9nKGBzdGFydGluZyB3aXRoIGRpZmYgb2YgJHtkaWZmfWApO1xuXHRcdFx0XHRzdGVtcy5tYXAoc3RlbSA9PiBzdGVtLnN0b3AoKSk7XG5cdFx0XHRcdHNldFRpbWVvdXQoKCkgPT4ge1xuXHRcdFx0XHRcdHBsYXlBbGxTdGVtcygpO1xuXHRcdFx0XHRcdHJlc29sdmUoKTtcblx0XHRcdFx0fSwgMjUwKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvbnNvbGUubG9nKGBkaWZmOiAke2RpZmZ9ICAtIHRyeWluZyBhZ2Fpbi4uYCk7XG5cdFx0XHRcdHN0ZW1zLm1hcChzdGVtID0+IHN0ZW0uc3RvcCgpKTtcblx0XHRcdFx0c2V0VGltZW91dChjaGVja1N5bmMsIDEwMDApO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRzZXRUaW1lb3V0KGNoZWNrU3luYywgMTAwMCk7XG5cdH0pO1xuXG5cdGZ1bmN0aW9uIHBsYXkoKSB7XG5cdFx0dHJhY2suYWN0aXZlID0gdHJ1ZTtcblx0XHR0cmFjay5lbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2xvYWRpbmcnKTtcblx0XHQvLyBkb24ndCBkbyBhbnl0aGluZyBpZiBpdCdzIG5vdCByZWFkeS4gVGhlIHVzZXIgc2hvdWxkbid0IGJlXG5cdFx0Ly8gYWJsZSB0byBwbGF5IHRoZSB0cmFjayB1bnRpbCBpdCdzIHJlYWR5IGFueXdheSwgdGhvdWdoLlxuXHRcdGlmICghdHJhY2sucmVhZHkpIHJldHVybiBmYWxzZTtcblx0XHQvLyBjb25zdCBpc1N5bmNlZCA9IHN0YXJ0U3luY2VkKCk7XG5cdFx0c3RhcnRTeW5jZWQoKS50aGVuKCgpID0+IHtcblx0XHRcdHRyYWNrLmVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnbG9hZGluZycpO1xuXHRcdFx0dHJhY2suZWxlbWVudC5jbGFzc0xpc3QuYWRkKCdwbGF5aW5nJyk7XG5cdFx0XHRwdWJsaXNoZXIuZW1pdCgndHJhY2tQbGF5ZWQnLCB0cmFja0luZGV4LCBzdGVtcy5sZW5ndGgpO1xuXHRcdH0pO1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0ZnVuY3Rpb24gc3RvcCgpIHtcblx0XHRzdGVtcy5tYXAoc3RlbSA9PiBzdGVtLnN0b3AoKSk7XG5cdFx0dHJhY2suYWN0aXZlID0gZmFsc2U7XG5cdFx0dHJhY2suZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdwbGF5aW5nJyk7XG5cdH1cblxuXHQvKipcblx0ICogQmluZCBldmVudCBsaXN0ZW5lcnMgJiBlbWl0dGVyc1xuXHQgKi9cblxuXHR0cmFjay5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgcGxheSk7XG5cblx0cHVibGlzaGVyLnN1YnNjcmliZSgndHJhY2tQbGF5ZWQnLCAobmV3SW5kZXgpID0+IHtcblx0XHRpZiAobmV3SW5kZXggPT09IHRyYWNrSW5kZXgpIHtcblx0XHRcdGlmICghdHJhY2suYWN0aXZlKSBwbGF5KCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHN0b3AoKTtcblx0XHR9XG5cdH0pO1xuXG5cdHB1Ymxpc2hlci5zdWJzY3JpYmUoJ3N0ZW1BY3RpdmF0ZWQnLCAoc3RlbUluZGV4KSA9PiB7XG5cdFx0aWYgKHRyYWNrLmFjdGl2ZSkgc3RlbXNbc3RlbUluZGV4XS51bm11dGUoKTtcblx0fSk7XG5cdHB1Ymxpc2hlci5zdWJzY3JpYmUoJ3N0ZW1EZWFjdGl2YXRlZCcsIChzdGVtSW5kZXgpID0+IHtcblx0XHRjb25zb2xlLmxvZyhzdGVtSW5kZXgsIHRyYWNrLmFjdGl2ZSk7XG5cdFx0aWYgKHRyYWNrLmFjdGl2ZSkgc3RlbXNbc3RlbUluZGV4XS5tdXRlKCk7XG5cdH0pO1xuXG5cdHB1Ymxpc2hlci5zdWJzY3JpYmUoJ2FsbFN0ZW1zQWN0aXZhdGVkJywgcGxheUFsbFN0ZW1zKTtcblxuXHQvKipcblx0ICogRGVidWcgbG9nZ2luZ1xuXHQgKi9cblxuXHRjb25zdCBkZWJ1Z091dHB1dCA9IHF1ZXJ5T25lKCcjZGVidWctb3V0cHV0Jyk7XG5cblx0cHVibGlzaGVyLnN1YnNjcmliZSgndHJhY2tQbGF5ZWQnLCAoKSA9PiB7XG5cdFx0ZGVidWdPdXRwdXQuaW5uZXJIVE1MID0gJyc7XG5cdH0pO1xuXG5cdGZ1bmN0aW9uIHBhZChpbnB1dCwgcGFkTGVuZ3RoID0gMiwgY2hhciA9ICcwJywgZGlyZWN0aW9uID0gJ3JpZ2h0Jykge1xuXHRcdGxldCBzdHJpbmcgPSBpbnB1dC50b1N0cmluZygpO1xuXHRcdGNvbnN0IGRpZmYgPSBwYWRMZW5ndGggLSBpbnB1dC5sZW5ndGg7XG5cdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBkaWZmOyBpICs9IDEpIHtcblx0XHRcdGlmIChkaXJlY3Rpb24gPT09ICdyaWdodCcpIHtcblx0XHRcdFx0c3RyaW5nICs9IGNoYXI7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRzdHJpbmcgPSBjaGFyICsgc3RyaW5nO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gc3RyaW5nO1xuXHR9XG5cblx0ZnVuY3Rpb24gZm9ybWF0RGVjaW1hbChpbnB1dCwgbExlbmd0aCwgckxlbmd0aCkge1xuXHRcdGNvbnN0IGFyciA9IGlucHV0LnRvU3RyaW5nKCkuc3BsaXQoJy4nKTtcblx0XHRpZiAoYXJyLmxlbmd0aCA9PT0gMSkgYXJyLnB1c2goJzAnKTtcblx0XHRjb25zdCB3aG9sZSA9IHBhZChhcnJbMF0sIGxMZW5ndGgsICcwJywgJ2xlZnQnKTtcblx0XHRjb25zdCBkZWMgPSBwYWQoYXJyWzFdLCByTGVuZ3RoLCAnMCcsICdyaWdodCcpLnN1YnN0cigwLCByTGVuZ3RoKTtcblx0XHRyZXR1cm4gYCR7d2hvbGV9LiR7ZGVjfWA7XG5cdH1cblxuXHRzZXRJbnRlcnZhbCgoKSA9PiB7XG5cdFx0aWYgKHRyYWNrLmFjdGl2ZSkge1xuXHRcdFx0Y29uc3QgZGVidWdTdHJpbmcgPSBbJyoqKioqKionXTtcblx0XHRcdGxldCBtaW47XG5cdFx0XHRsZXQgbWF4O1xuXHRcdFx0c3RlbXMubWFwKChzdGVtLCBpbmRleCkgPT4ge1xuXHRcdFx0XHRpZiAoc3RlbS5hdWRpbykge1xuXHRcdFx0XHRcdGNvbnN0IGFjdGl2YXRlZCA9IChzdGVtLmFjdGl2ZSkgPyAnYWN0aXZhdGVkJyA6ICdkZWFjdGl2YXRlZCc7XG5cdFx0XHRcdFx0Y29uc3QgY3VycmVudFRpbWUgPSBNYXRoLnJvdW5kKHN0ZW0uYXVkaW8uY3VycmVudFRpbWUgKiAxMDAwMCkgLyAxMDAwMDtcblx0XHRcdFx0XHRjb25zdCBmb3JtYXR0ZWRUaW1lID0gZm9ybWF0RGVjaW1hbChjdXJyZW50VGltZSwgMywgNCk7XG5cblx0XHRcdFx0XHRtaW4gPSAobWluKSA/IE1hdGgubWluKG1pbiwgY3VycmVudFRpbWUpIDogY3VycmVudFRpbWU7XG5cdFx0XHRcdFx0bWF4ID0gKG1heCkgPyBNYXRoLm1heChtYXgsIGN1cnJlbnRUaW1lKSA6IGN1cnJlbnRUaW1lO1xuXHRcdFx0XHRcdGlmIChjdXJyZW50VGltZSA9PT0gMCkgc3RlbS5hdWRpby5wbGF5KCk7XG5cdFx0XHRcdFx0ZGVidWdTdHJpbmcucHVzaChgICAgc3RlbSAke2luZGV4fTogJHtmb3JtYXR0ZWRUaW1lfSB8ICR7c3RlbS5maWxlTmFtZX0gLSAke2FjdGl2YXRlZH0gfCAke3N0ZW0uYXVkaW8uYnVmZmVyZWQuZW5kKDApfSAvICR7c3RlbS5hdWRpby5kdXJhdGlvbn1gKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0XHRjb25zdCBkaWZmID0gZm9ybWF0RGVjaW1hbChtYXggLSBtaW4sIDEsIDYpO1xuXHRcdFx0ZGVidWdTdHJpbmcucHVzaChgICAgbWF4IGRpZmY6ICR7ZGlmZn1gKTtcblx0XHRcdGRlYnVnT3V0cHV0LmlubmVySFRNTCA9IGRlYnVnU3RyaW5nLmpvaW4oJzxicj4nKTtcblx0XHR9XG5cdH0sIDEwMCk7XG5cblx0dHJhY2suc3RlbXNDb3VudCA9IHN0ZW1zLmxlbmd0aDtcblx0cmV0dXJuIHRyYWNrO1xufVxuXG5cbmV4cG9ydCBkZWZhdWx0IG1ha2VUcmFjaztcbiIsIlxuY2xhc3MgUHViU3ViRW1pdHRlciB7XG5cdGNvbnN0cnVjdG9yKCkge1xuXHRcdC8vIGNyZWF0ZSBhIG5ldyBNYXAgdG8gaG9sZCBhbGwgb2YgdGhlIHRvcGljc1xuXHRcdHRoaXMubGlzdGVuZXJzID0gbmV3IE1hcCgpO1xuXHR9XG5cblx0c3Vic2NyaWJlKHRvcGljLCBjYWxsYmFjaykge1xuXHRcdC8vIGlmIHRoZSBsaXN0ZW5lciBkb2VzIG5vdCBoYWUgdGhlIHRvcGljIHlldCwgYWRkIGl0LlxuXHRcdGlmICghdGhpcy5saXN0ZW5lcnMuaGFzKHRvcGljKSkgdGhpcy5saXN0ZW5lcnMuc2V0KHRvcGljLCBbXSk7XG5cdFx0Ly8gcHVzaCB0aGUgY2FsbGJhY2sgdG8gdGhlIHRvcGljJ3MgYXJyYXlcblx0XHR0aGlzLmxpc3RlbmVycy5nZXQodG9waWMpLnB1c2goY2FsbGJhY2spO1xuXHR9XG5cblx0dW5zdWJzY3JpYmUodG9waWMsIGNhbGxiYWNrKSB7XG5cdFx0Y29uc3QgbGlzdGVuZXJzID0gdGhpcy5saXN0ZW5lcnMuZ2V0KHRvcGljKTtcblx0XHRsZXQgaW5kZXg7XG5cblx0XHRpZiAobGlzdGVuZXJzICYmIGxpc3RlbmVycy5sZW5ndGgpIHtcblx0XHRcdC8vIGZpbmQgdGhlIGluZGV4IG9mIHRoZSBjYWxsYmFjayB3ZSdyZSByZW1vdmluZ1xuXHRcdFx0aW5kZXggPSBsaXN0ZW5lcnMucmVkdWNlKChpLCBsaXN0ZW5lciwgY3VycmVudEluZGV4KSA9PiB7XG5cdFx0XHRcdCh0eXBlb2YobGlzdGVuZXIpID09PSAnZnVuY3Rpb24nICYmIGxpc3RlbmVyID09PSBjYWxsYmFjaykgP1xuXHRcdFx0XHRcdGkgPSBjdXJyZW50SW5kZXggOlxuXHRcdFx0XHRcdGk7XG5cdFx0XHR9LCAtMSk7XG5cblx0XHRcdGlmIChpbmRleCA+IC0xKSB7XG5cdFx0XHRcdC8vIGlmIHdlIGZvdW5kIGEgbWF0Y2gsIHNwbGljZSBpdCBvdXQsIGFuZCByZXN1cHBseSB0aGUgbWFwIHdpdGggdGhlIHNwbGljZWQgYXJyYXlcblx0XHRcdFx0bGlzdGVuZXJzLnNwbGljZShpbmRleCwgMSk7XG5cdFx0XHRcdHRoaXMubGlzdGVuZXJzLnNldCh0b3BpYywgbGlzdGVuZXJzKTtcblx0XHRcdFx0cmV0dXJuIHRydWU7IC8vIHJldHVybiB0cnVlIGlmIHdlIHJlbW92ZWQgc29tZXRoaW5nXG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiBmYWxzZTsgLy8gcmV0dXJuIGZhbHNlIGlmIHdlIGRpZG4ndFxuXHR9XG5cblx0ZW1pdCh0b3BpYywgLi4uYXJncykge1xuXHRcdC8vIGdldCB0aGUgbGlzdGVuZXJzIHN1YnNjcmliZWQgdG8gdGhlIHRvcGljXG5cdFx0Y29uc3QgbGlzdGVuZXJzID0gdGhpcy5saXN0ZW5lcnMuZ2V0KHRvcGljKTtcblxuXHRcdGlmIChsaXN0ZW5lcnMgJiYgbGlzdGVuZXJzLmxlbmd0aCkge1xuXHRcdFx0Ly8gZXhlY3V0ZSBlYWNoIGNhbGxiYWNrIHdpdGggYW55IHN1cHBsaWVkIGFyZ3VtZW50c1xuXHRcdFx0bGlzdGVuZXJzLmZvckVhY2goKGxpc3RlbmVyKSA9PiB7XG5cdFx0XHRcdGxpc3RlbmVyKC4uLmFyZ3MpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHR9XG5cdFx0cmV0dXJuIGZhbHNlO1xuXHR9XG59XG5cbmNvbnN0IHB1Ymxpc2hlciA9IG5ldyBQdWJTdWJFbWl0dGVyKCk7XG5cbmV4cG9ydCBkZWZhdWx0IHB1Ymxpc2hlcjtcbiIsIi8vIEEgc21hbGwgdXRpbGl0eSBmb3IgZ2V0dGluZyBET00gZWxlbWVudHNcbmltcG9ydCB7IHF1ZXJ5LCBxdWVyeU9uZSB9IGZyb20gJ0BhcnRjb21tYWNvZGUvcSc7XG5cbi8vIEEgY29tcG9uZW50IHlvdSBjYW4gdXNlIHRvIGVtaXQgYW5kIHN1YnNjcmliZSB0byBldmVudHMuXG4vLyBIZWxwZnVsIHRvIGRlY291cGxlIFVJIHN0dWZmXG5pbXBvcnQgcHVibGlzaGVyIGZyb20gJy4vY29tcG9uZW50cy9wdWJsaXNoZXInO1xuaW1wb3J0IG1ha2VUcmFjayBmcm9tICcuL2NvbXBvbmVudHMvVHJhY2snO1xuaW1wb3J0IG1ha2VCdXR0b24gZnJvbSAnLi9jb21wb25lbnRzL0J1dHRvbic7XG5cbi8vIGZpcnN0LCBqdXN0IGZpbmQgdGhlIGVsZW1lbnRzXG5jb25zdCB0cmFja0VsZW1lbnRzID0gcXVlcnkoJy5zdGVtLXRyYWNrJyk7XG5jb25zdCBldmVyeXRoaW5nID0gcXVlcnlPbmUoJy5zdGVtLWJ1dHRvbnMgLnBsYXktYWxsJykgfHwgZmFsc2U7XG5jb25zdCBidXR0b25zID0gW107XG5jb25zdCB0cmFja3MgPSBbXTtcblxubGV0IHJlYWR5Q291bnQgPSAwO1xuXG5mdW5jdGlvbiByZWFkeUhhbmRsZXIoKSB7XG5cdHJlYWR5Q291bnQgKz0gMTtcblx0aWYgKHJlYWR5Q291bnQgPT09IHRyYWNrcy5sZW5ndGgpIHtcblx0XHRxdWVyeU9uZSgnLnN0ZW1zLWNvbnRhaW5lcicpLmNsYXNzTGlzdC5hZGQoJ3JlYWR5Jyk7XG5cdH1cbn1cblxuLy8gYWRkIGVhY2ggY29tcG9zZWQgdHJhY2sgdG8gYW4gYXJyYXlcbnRyYWNrRWxlbWVudHMubWFwKCh0cmFjaywgaW5kZXgpID0+IHtcblx0Y29uc3QgbmV3VHJhY2sgPSBtYWtlVHJhY2sodHJhY2ssIGluZGV4LCBwdWJsaXNoZXIsIHJlYWR5SGFuZGxlcik7XG5cdHRyYWNrcy5wdXNoKG5ld1RyYWNrKTtcbn0pO1xuXG5xdWVyeSgnLnN0ZW0tYnV0dG9ucyAuc3RlbS1idXR0b24nKS5tYXAoKGJ1dHRvbiwgaW5kZXgpID0+IHtcblx0Y29uc3QgbmV3QnV0dG9uID0gbWFrZUJ1dHRvbihidXR0b24sIGluZGV4LCBwdWJsaXNoZXIpO1xuXHRidXR0b25zLnB1c2gobmV3QnV0dG9uKTtcbn0pO1xuXG4vKipcbiAqIEV2ZW50IExpc3RlbmVyc1xuICovXG5cbmlmIChldmVyeXRoaW5nKSB7XG5cdGV2ZXJ5dGhpbmcuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG5cdFx0cHVibGlzaGVyLmVtaXQoJ2FsbFN0ZW1zQWN0aXZhdGVkJyk7XG5cdH0pO1xufVxuXG4vLyBVc2UgZWFjaCB0cmFjayBlbGVtZW50IGFzIHRoZSBzb3VyY2Ugb2YgYSBTdGVtIG9iamVjdFxuIl19"}