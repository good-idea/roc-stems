!function e(t,n,r){function s(i,a){if(!n[i]){if(!t[i]){var u="function"==typeof require&&require;if(!a&&u)return u(i,!0);if(o)return o(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[i]={exports:{}};t[i][0].call(l.exports,function(e){return s(t[i][1][e]||e)},l,l.exports,e,t,n,r)}return n[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)s(r[i]);return s}({"/Users/Joseph/Sites/rideorcry/stems/node_modules/@artcommacode/q/index.js":[function(e,t,n){"use strict";function r(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(e){return[].concat(r(e))},o=function(e){return e[0]},i=function(e){throw new Error('"'+String(e)+"\" does't exist in the document")},a=function(e){return e?document&&document.body&&document.body.contains(e)?e:i(e):document},u=n.query=function(e,t){var n=a(t);return n?s(n.querySelectorAll(e)):[]};n.queryOne=function(e,t){return o(u(e,t))}},{}],"/Users/Joseph/Sites/rideorcry/stems/src/js/components/Button.js":[function(e,t,n){"use strict";function r(e,t,n){var r={};return r.element=e,r.enable=function(){r.enabled=!0,r.element.classList.add("enabled")},r.disable=function(){r.enabled=!1,r.element.classList.remove("enabled")},r.toggleEnabled=function(){r.enabled?r.disable():r.enable()},r.activate=function(){r.enabled||r.enable(),r.active=!0,r.element.classList.add("active")},r.deactivate=function(){r.active=!1,r.element.classList.remove("active")},r.toggleActive=function(e){r.active=e||!r.active,!0===r.active?r.activate():r.deactivate()},n.subscribe("enableButtons",function(e){t<=e-1?(r.enable(),r.activate()):(r.disable(),r.deactivate())}),n.subscribe("disableButtons",function(){r.deactivate()}),r.element.addEventListener("click",function(){r.toggleActive();var e=r.active?"stemActivated":"stemDeactivated";n.emit(e,t)}),r}Object.defineProperty(n,"__esModule",{value:!0}),n.default=r},{}],"/Users/Joseph/Sites/rideorcry/stems/src/js/components/Stem.js":[function(e,t,n){"use strict";function r(e){var t={};return t.audio=new Audio,t.load=function(n){t.fileName=e.replace(/\/$/).split("/").pop();var r=new XMLHttpRequest;r.open("GET",encodeURI(e),!0),r.setRequestHeader("Content-Type","application/json"),r.responseType="blob",r.onload=function(e){var s=new Blob([r.response],{type:"audio/mp3"}),o=URL.createObjectURL(s);t.audio.src=o,t.audio.onload=function(){URL.revokeObjectURL(o)},t.ready=!0;var i=200!==e.target.status&&e.target.status+" "+e.target.statusText;n(i)},r.send()},t.play=function(e){return e&&(t.audio.volume=0),new Promise(function(e,n){t.ready||n("stem is not ready"),t.audio.play().then(function(){t.audio.volume=1,t.active=!0,e()}).catch(function(){n()})})},t.reset=function(){t.audio.pause(),t.audio.currentTime=0},t.stop=function(){t.active=!1,t.audio.pause()},t.unmute=function(e){e&&1===t.audio.volume?(e&&(t.audio.currentTime=e),console.log(t.audio.currentTime),t.play()):(t.active=!0,t.audio.volume=1)},t.mute=function(){t.active=!1,t.audio.volume=0,1===t.audio.volume&&t.stop()},t}Object.defineProperty(n,"__esModule",{value:!0}),n.default=r},{}],"/Users/Joseph/Sites/rideorcry/stems/src/js/components/Track.js":[function(e,t,n){"use strict";function r(e,t,n){function r(e){p+=1,e&&(c.hasError=!0,c.element.classList.add("has-errors")),p===f.length&&(c.isLoaded=!0,c.element.classList.remove("loading"),c.element.classList.add("loaded"),m&&c.play())}function o(){c.isLoaded?c.play():c.load()}function a(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"0",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"right",s=e.toString(),o=t-e.length,i=0;i<o;i+=1)"right"===r?s+=n:s=n+s;return s}function u(e,t,n){var r=e.toString().split(".");return 1===r.length&&r.push("0"),a(r[0],t,"0","left")+"."+a(r[1],n,"0","right").substr(0,n)}var c={};c.element=e;var l=JSON.parse(c.element.getAttribute("data-stems")),d=c.element.hasAttribute("autoload")&&"false"!==c.element.getAttribute("autoload"),m=c.element.hasAttribute("autoplay")&&"false"!==c.element.getAttribute("autoplay"),f=[],p=0;l.map(function(e){var t=(0,i.default)(e);f.push(t)}),c.load=function(){c.element.classList.add("loading"),f.map(function(e){return e.load(r)})},c.play=function(){c.active=!0;var e=[];f.map(function(t){e.push(t.play(!0))}),Promise.all(e).then(function(){n.emit("trackPlayed",t),setTimeout(function(){f.map(function(e){e.reset(),e.play()}),n.emit("enableButtons",f.length),c.element.classList.add("playing"),c.startTime=Date.now()},400)})},c.stop=function(){c.active=!1,c.startTime=!1,f.map(function(e){return e.reset()}),c.element.classList.remove("playing")},c.getCurrentTime=function(){if(!c.active)return null;var e=[];f.map(function(t){e.push(t.audio.currentTime)});var t=Math.max.apply(Math,e);console.log("mathmax: ",t);var n=Date.now(),r=(n-c.startTime)/1e3;return console.log("elapsed: ",r),Math.max(r,t)},c.unmuteStem=function(e){if(c.active){var t=c.getCurrentTime();console.log(t),f[e].unmute(t)}},c.muteStem=function(e){c.active&&f[e].mute()},c.element.addEventListener("click",o),n.subscribe("trackPlayed",function(e){e!==t&&(c.active=!1,c.stop())}),n.subscribe("stemActivated",c.unmuteStem),n.subscribe("stemDeactivated",c.muteStem),n.subscribe("allStemsToggled",function(){c.active&&(f.filter(function(e){return e.active}).length===f.length?(f.map(function(e,t){return c.muteStem(t)}),n.emit("disableButtons",f.length)):(f.map(function(e,t){return c.unmuteStem(t)}),n.emit("enableButtons",f.length)))}),d&&c.load();var v=(0,s.queryOne)("#debug-output");return n.subscribe("trackPlayed",function(){v.innerHTML=""}),setInterval(function(){if(c.active){var e=["*******"],t=void 0,n=void 0;f.map(function(r,s){if(r.audio){var o=r.active?"(on)":"(off)",i=Math.round(1e4*r.audio.currentTime)/1e4,a=u(i,3,4);r.active&&(t=t?Math.min(t,i):i,n=n?Math.max(n,i):i),0===i&&r.audio.play().catch(function(){c.active=!1});try{e.push("   stem "+(s+1)+": "+a+" | "+r.fileName+" - "+o)}catch(e){}}});var r=u(n-t,1,6);e.push("   max diff: "+r),v.innerHTML=e.join("<br>")}},100),c}Object.defineProperty(n,"__esModule",{value:!0});var s=e("@artcommacode/q"),o=e("./Stem"),i=function(e){return e&&e.__esModule?e:{default:e}}(o);n.default=r},{"./Stem":"/Users/Joseph/Sites/rideorcry/stems/src/js/components/Stem.js","@artcommacode/q":"/Users/Joseph/Sites/rideorcry/stems/node_modules/@artcommacode/q/index.js"}],"/Users/Joseph/Sites/rideorcry/stems/src/js/components/publisher.js":[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(){r(this,e),this.listeners=new Map}return s(e,[{key:"subscribe",value:function(e,t){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(t)}},{key:"unsubscribe",value:function(e,t){var n=this.listeners.get(e),r=void 0;return!!(n&&n.length&&(r=n.reduce(function(e,t,n){},-1))>-1)&&(n.splice(r,1),this.listeners.set(e,n),!0)}},{key:"emit",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var s=this.listeners.get(e);return!(!s||!s.length||(s.forEach(function(e){e.apply(void 0,n)}),0))}}]),e}(),i=new o;n.default=i},{}],"/Users/Joseph/Sites/rideorcry/stems/src/js/stems.js":[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var s=e("@artcommacode/q"),o=e("./components/publisher"),i=r(o),a=e("./components/Track"),u=r(a),c=e("./components/Button"),l=r(c),d=(0,s.query)(".stem-track"),m=(0,s.queryOne)(".stem-button--play-all")||!1,f=[],p=[];d.map(function(e,t){var n=(0,u.default)(e,t,i.default);p.push(n)}),(0,s.query)(".stem-buttons .stem-button").map(function(e,t){var n=(0,l.default)(e,t,i.default);f.push(n)}),m&&m.addEventListener("click",function(){i.default.emit("allStemsToggled")})},{"./components/Button":"/Users/Joseph/Sites/rideorcry/stems/src/js/components/Button.js","./components/Track":"/Users/Joseph/Sites/rideorcry/stems/src/js/components/Track.js","./components/publisher":"/Users/Joseph/Sites/rideorcry/stems/src/js/components/publisher.js","@artcommacode/q":"/Users/Joseph/Sites/rideorcry/stems/node_modules/@artcommacode/q/index.js"}]},{},["/Users/Joseph/Sites/rideorcry/stems/src/js/stems.js"]);
//# sourceMappingURL=stems.js.map
